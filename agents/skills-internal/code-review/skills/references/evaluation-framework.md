# ⭐️ 5段階評価フレームワーク

コードレビューにおける品質評価の統一基準を定義します。

## 評価レベル定義

### ⭐️⭐️⭐️⭐️⭐️ (5/5) 優秀 - Excellent

**基準**:

- 全ての観点で非常に高い品質を達成
- ベストプラクティスを一貫して適用
- 将来の拡張性と保守性を十分に考慮
- コードが模範的で他のプロジェクトの参考になるレベル

**特徴**:

- 包括的なエラーハンドリング
- 適切な抽象化と分離
- 優れたテストカバレッジ
- 明確なドキュメント
- パフォーマンスが最適化されている

**アクション**: なし（維持・共有）

### ⭐️⭐️⭐️⭐️☆ (4/5) 良好 - Good

**基準**:

- ほとんどの観点で良い品質を達成
- 軽微な改善点はあるが、全体的に堅実
- 基本的な要件を十分に満たしている
- 小さな最適化の余地がある

**特徴**:

- 適切なエラーハンドリング
- 合理的な設計と構造
- 十分なテストカバレッジ
- 基本的なドキュメント
- 許容可能なパフォーマンス

**アクション**: 軽微な改善を推奨（優先度：低）

### ⭐️⭐️⭐️☆☆ (3/5) 標準 - Standard

**基準**:

- 基本的な要件は満たしている
- いくつかの改善が必要
- 動作に問題はないが最適ではない
- 技術的負債の蓄積リスクあり

**特徴**:

- 基本的なエラーハンドリングあり
- 機能的には動作するが設計に改善余地
- 限定的なテストカバレッジ
- ドキュメントが不十分
- パフォーマンス改善の余地あり

**アクション**: 改善を推奨（優先度：中）

### ⭐️⭐️☆☆☆ (2/5) 要改善 - Needs Improvement

**基準**:

- 重要な問題がある
- 修正が強く推奨される
- 将来の問題やバグの可能性が高い
- 保守性が低い

**特徴**:

- 不十分なエラーハンドリング
- 設計上の問題あり
- テストが不足
- ドキュメントがほぼない
- パフォーマンス問題あり

**アクション**: 早急な修正が必要（優先度：高）

### ⭐️☆☆☆☆ (1/5) 要再実装 - Requires Overhaul

**基準**:

- 根本的な問題がある
- 設計から見直しが必要
- 重大なセキュリティや信頼性のリスクを含む
- そのまま本番環境に投入すべきではない

**特徴**:

- エラーハンドリングがない
- 設計が破綻している
- テストがない
- ドキュメントがない
- 深刻なパフォーマンス問題

**アクション**: 即座の再設計・再実装が必須（優先度：最高）

## 評価次元

各次元について独立して評価し、総合評価を算出します。

### 1. コード品質 (Code Quality)

**評価観点**:

- 可読性（命名、構造、コメント）
- 保守性（DRY、SOLID、抽象化）
- 一貫性（規約、パターン、スタイル）

**⭐️5**: 模範的な可読性、完璧なDRY原則適用、一貫したスタイル
**⭐️4**: 良好な可読性、適切な抽象化、ほぼ一貫したスタイル
**⭐️3**: 許容可能な可読性、一部の重複、スタイルに多少のばらつき
**⭐️2**: 読みにくい部分あり、重複多数、スタイル不統一
**⭐️1**: 非常に読みにくい、大量の重複、規約無視

### 2. セキュリティ (Security)

**評価観点**:

- 入力検証（サニタイゼーション、バリデーション）
- 認証・認可（権限チェック、セッション管理）
- データ保護（暗号化、機密情報の扱い）

**⭐️5**: 包括的なセキュリティ対策、多層防御、定期的な監査
**⭐️4**: 主要な脅威への対策、適切な検証、基本的な暗号化
**⭐️3**: 基本的なセキュリティ対策、一部脆弱性の可能性
**⭐️2**: 不十分なセキュリティ、既知の脆弱性パターン存在
**⭐️1**: セキュリティ対策なし、重大な脆弱性あり

### 3. パフォーマンス (Performance)

**評価観点**:

- アルゴリズム効率（時間計算量、空間計算量）
- リソース使用（メモリ、CPU、ネットワーク）
- スケーラビリティ（負荷増加時の挙動）

**⭐️5**: 最適化済み、スケーラブル、リソース効率的
**⭐️4**: 効率的、適切なリソース使用、十分なスケーラビリティ
**⭐️3**: 許容可能な性能、改善の余地あり
**⭐️2**: パフォーマンス問題あり、ボトルネック存在
**⭐️1**: 深刻なパフォーマンス問題、スケールしない

### 4. テスト (Testing)

**評価観点**:

- カバレッジ（ユニット、統合、E2E）
- テスト品質（AAA、独立性、保守性）
- エッジケース（境界値、異常系）

**⭐️5**: 包括的なテスト、高カバレッジ、優れたテスト設計
**⭐️4**: 十分なテスト、良好なカバレッジ、適切なテスト設計
**⭐️3**: 基本的なテスト、限定的カバレッジ、一部改善必要
**⭐️2**: 不十分なテスト、低カバレッジ、テスト品質に問題
**⭐️1**: テストなし、またはほぼ無意味なテスト

### 5. エラーハンドリング (Error Handling)

**評価観点**:

- 例外処理（適切なキャッチ、リカバリー）
- エラー伝播（型安全、情報保持）
- ユーザー体験（メッセージ、ログ）

**⭐️5**: 包括的なエラー処理、型安全、優れたUX
**⭐️4**: 適切なエラー処理、合理的な伝播、良好なUX
**⭐️3**: 基本的なエラー処理、一部改善必要
**⭐️2**: 不十分なエラー処理、エラーが隠蔽される可能性
**⭐️1**: エラー処理なし、クラッシュの危険性

### 6. アーキテクチャ (Architecture)

**評価観点**:

- 層分離（責任分離、依存関係）
- 拡張性（新機能追加の容易さ）
- ドメインモデリング（ビジネスロジックの表現）

**⭐️5**: 優れた層分離、高い拡張性、明確なドメインモデル
**⭐️4**: 適切な層分離、良好な拡張性、合理的なモデル
**⭐️3**: 基本的な分離、一部の拡張性、改善余地あり
**⭐️2**: 不十分な分離、拡張困難、モデリングに問題
**⭐️1**: 層が混在、拡張不可能、設計破綻

## 総合評価の算出

### 加重平均方式

プロジェクトタイプに応じて各次元の重みを調整：

**API/Backend**:

```
総合評価 = (
    セキュリティ × 0.25 +
    パフォーマンス × 0.20 +
    コード品質 × 0.20 +
    エラーハンドリング × 0.15 +
    アーキテクチャ × 0.15 +
    テスト × 0.05
)
```

**Frontend/UI**:

```
総合評価 = (
    コード品質 × 0.25 +
    パフォーマンス × 0.20 +
    テスト × 0.20 +
    アーキテクチャ × 0.15 +
    エラーハンドリング × 0.10 +
    セキュリティ × 0.10
)
```

**Fullstack**:

```
総合評価 = (
    セキュリティ × 0.20 +
    コード品質 × 0.20 +
    パフォーマンス × 0.15 +
    テスト × 0.15 +
    アーキテクチャ × 0.15 +
    エラーハンドリング × 0.15
)
```

### 最低スコア方式（オプション）

重大な問題領域がある場合、最低スコアを総合評価として採用：

```python
def calculate_overall_rating(ratings, use_minimum=False):
    if use_minimum and any(rating <= 2 for rating in ratings.values()):
        # セキュリティまたはテストが⭐️2以下の場合は総合評価も抑える
        return min(ratings.values())
    else:
        # 通常は加重平均を使用
        return weighted_average(ratings, weights)
```

## アクション閾値

評価に基づく推奨アクション：

### ⭐️5 (優秀)

- **アクション**: 現状維持、ベストプラクティスとして共有
- **次のステップ**: パフォーマンス最適化、ドキュメント充実化（オプション）

### ⭐️4 (良好)

- **アクション**: 軽微な改善を推奨（優先度：低）
- **次のステップ**: 特定された改善点を時間があるときに対処

### ⭐️3 (標準)

- **アクション**: 改善を推奨（優先度：中）
- **次のステップ**: 次回のリファクタリング時に対処、技術的負債として記録

### ⭐️2 (要改善)

- **アクション**: 早急な修正が必要（優先度：高）
- **次のステップ**: 次回のスプリント/イテレーションで必ず対処

### ⭐️1 (要再実装)

- **アクション**: 即座の再設計・再実装が必須（優先度：最高）
- **次のステップ**: 本番投入を中止し、すぐに設計から見直し

## 出力フォーマット

### 標準フォーマット

```markdown
# コードレビュー結果

## 総合評価: ⭐️⭐️⭐️⭐️☆ (4/5) 良好

## 次元別評価

| 次元               | 評価       | コメント                           |
| ------------------ | ---------- | ---------------------------------- |
| コード品質         | ⭐️⭐️⭐️⭐️⭐️ | 優れた可読性、一貫したスタイル     |
| セキュリティ       | ⭐️⭐️⭐️⭐️☆  | 主要な対策済み、CSRF対策を追加推奨 |
| パフォーマンス     | ⭐️⭐️⭐️⭐️☆  | 効率的、N+1問題の解消を推奨        |
| テスト             | ⭐️⭐️⭐️☆☆   | カバレッジ向上が必要               |
| エラーハンドリング | ⭐️⭐️⭐️⭐️☆  | 適切、一部のエッジケース対応を推奨 |
| アーキテクチャ     | ⭐️⭐️⭐️⭐️⭐️ | クリーンな層分離、優れた拡張性     |

## 優先度付きアクションプラン

### 🔴 高優先度

なし

### 🟡 中優先度

1. **テストカバレッジ向上** (src/services/user.ts:45)
   - 現状: 60% → 目標: 80%+
   - エッジケース追加が必要

### 🟢 低優先度

1. **CSRF対策追加** (src/middleware/auth.ts:23)
   - csrfトークン検証の実装を推奨

2. **N+1クエリ解消** (src/repositories/post.ts:78)
   - eager loadingの適用を推奨
```

### シンプルフォーマット（Simple Mode用）

```markdown
# コードレビュー結果（簡易）

## 発見された問題

### 🔴 セキュリティ (3件)

- [高] 未検証の入力: src/api/user.ts:34
- [中] CSRF対策なし: src/middleware/auth.ts:23
- [低] パスワード強度チェック不足: src/services/auth.ts:56

### 🟡 パフォーマンス (2件)

- [中] N+1クエリ: src/repositories/post.ts:78
- [低] 非効率なループ: src/utils/transform.ts:12

### 🟢 コード品質 (5件)

- [中] 複雑度が高い関数: src/services/order.ts:45 (CC=15)
- [低] 重複コード: src/components/Button.tsx, src/components/Link.tsx
- ...

## 推奨アクション

1. セキュリティ問題を優先的に対処
2. N+1クエリを解消
3. 複雑な関数をリファクタリング
```

## 使用例

### Detailed Modeでの使用

```python
# 評価実行
result = execute_detailed_review(targets, criteria, project_info)

# 各次元の評価
ratings = {
    "code_quality": 5,
    "security": 4,
    "performance": 4,
    "testing": 3,
    "error_handling": 4,
    "architecture": 5
}

# 総合評価算出（Fullstackプロジェクト）
overall = calculate_overall_rating(ratings, project_type="fullstack")
# → 4.2 → ⭐️⭐️⭐️⭐️☆

# アクション生成
actions = generate_actions(ratings)
```

### Simple Modeでの使用

```python
# 問題の優先度付け
findings = {
    "security": [
        {"severity": "high", "file": "src/api/user.ts:34", ...},
        {"severity": "medium", "file": "src/middleware/auth.ts:23", ...}
    ],
    "performance": [
        {"severity": "medium", "file": "src/repositories/post.ts:78", ...}
    ]
}

# 簡易評価（問題数ベース）
quick_rating = calculate_quick_rating(findings)
# セキュリティ問題（高）あり → ⭐️⭐️☆☆☆
```

---

**重要**: この評価フレームワークは一貫性を保つために、すべてのレビューで統一的に適用してください。
