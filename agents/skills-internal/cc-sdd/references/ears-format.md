# EARS形式ガイド

EARS（Easy Approach to Requirements Syntax）は、明確で測定可能な要件を記述するための形式です。

## EARS とは

EARS は、要件を構造化された形式で記述することで、曖昧さを排除し、テスト可能な要件を作成するための方法論です。

### EARSの利点

1. **明確性**: 曖昧な表現を排除
2. **測定可能性**: すべての要件がテスト可能
3. **一貫性**: 統一された形式で記述
4. **トレーサビリティ**: 設計とタスクへの追跡が容易
5. **コミュニケーション**: ステークホルダー間の理解を促進

### cc-sdd での使用

cc-sdd では、requirements.md の受入基準をすべて EARS 形式で記述します。

---

## 基本パターン

EARS には4つの基本パターンがあります。

### 1. WHEN...THEN（イベント駆動）

**構文**: `WHEN [イベント/条件] THEN [システム/主語] SHALL [応答]`

**用途**: 特定のイベントや条件が発生した時の動作を定義

**例**:

```
WHEN ユーザーがログインボタンをクリック THEN システム SHALL メール/パスワード入力フォームを表示
WHEN ログイン試行が3回失敗 THEN システム SHALL アカウントを5分間ロック
WHEN 新規ユーザー登録が完了 THEN システム SHALL 確認メールを送信
WHEN セッションが30分間非アクティブ THEN システム SHALL ユーザーを自動ログアウト
```

**注意点**:

- イベントは明確で観測可能
- 応答は具体的で測定可能
- 主語（システム/コンポーネント）を明示

---

### 2. IF...THEN（条件付き）

**構文**: `IF [前提条件/状態] THEN [システム/主語] SHALL [応答]`

**用途**: 特定の状態や前提条件下での動作を定義

**例**:

```
IF ユーザーが管理者権限を持つ THEN システム SHALL 管理者ダッシュボードへのアクセスを許可
IF パスワードが8文字未満 THEN システム SHALL エラーメッセージを表示
IF メールアドレスが既に登録済み THEN システム SHALL 重複エラーを返す
IF ユーザーがログイン中 THEN システム SHALL プロフィール編集機能を表示
```

**注意点**:

- 前提条件は検証可能
- IF は状態、WHEN はイベント
- 条件が満たされない場合の動作も明確に

---

### 3. WHILE...THE（継続的な動作）

**構文**: `WHILE [継続条件] THE [システム/主語] SHALL [継続動作]`

**用途**: 特定の条件が満たされている間の継続的な動作を定義

**例**:

```
WHILE ユーザーがログイン中 THE システム SHALL セッション情報を保持
WHILE ファイルアップロードが進行中 THE システム SHALL 進捗バーを表示
WHILE パスワード入力フィールドにフォーカスがある THE システム SHALL パスワード強度インジケーターを表示
WHILE ユーザーがフォームを編集中 THE システム SHALL 自動保存を実行
```

**注意点**:

- 継続条件は明確な開始と終了がある
- 継続動作は中断されても安全
- パフォーマンスへの影響を考慮

---

### 4. WHERE...THE（文脈依存）

**構文**: `WHERE [場所/コンテキスト/トリガー] THE [システム/主語] SHALL [文脈動作]`

**用途**: 特定のコンテキストや場所での動作を定義

**例**:

```
WHERE ユーザープロフィールページ THE システム SHALL ユーザー情報編集ボタンを表示
WHERE モバイルデバイス THE システム SHALL レスポンシブレイアウトを適用
WHERE ダッシュボード画面 THE システム SHALL 最新5件のアクティビティを表示
WHERE エラーページ THE システム SHALL ホームに戻るリンクを提供
```

**注意点**:

- コンテキストは明確に定義
- 場所やUIの特定領域を指定
- 他のコンテキストとの違いを明確に

---

## 複合パターン

複数の条件を組み合わせることができます。

### WHEN...AND...THEN

**構文**: `WHEN [イベント] AND [追加条件] THEN [システム/主語] SHALL [応答]`

**例**:

```
WHEN ユーザーがログインボタンをクリック AND 認証情報が正しい THEN システム SHALL ダッシュボードにリダイレクト
WHEN パスワードリセット要求 AND メールアドレスが登録済み THEN システム SHALL リセットリンクを送信
WHEN ファイルアップロード AND ファイルサイズが10MB以下 THEN システム SHALL アップロードを受け入れ
```

---

### IF...AND...THEN

**構文**: `IF [条件] AND [追加条件] THEN [システム/主語] SHALL [応答]`

**例**:

```
IF ユーザーがログイン済み AND セッションが有効 THEN システム SHALL 保護されたリソースへのアクセスを許可
IF メールアドレスが有効 AND パスワードが基準を満たす THEN システム SHALL アカウント作成を完了
IF ユーザーが管理者 AND 対象ユーザーが存在 THEN システム SHALL ユーザー削除を許可
```

---

## 主語の選択

EARS 要件では、適切な主語を選択することが重要です。

### ソフトウェアプロジェクトの場合

具体的なシステム/サービス名を使用：

```
✓ 良い例:
WHEN ユーザーがログアウトボタンをクリック THEN 認証サービス SHALL セッションを無効化

✗ 悪い例:
WHEN ユーザーがログアウトボタンをクリック THEN システム SHALL セッションを無効化
```

**推奨される主語**:

- 具体的なサービス名: `認証サービス`, `決済サービス`, `通知サービス`
- コンポーネント名: `ダッシュボード`, `ユーザープロフィール`, `検索機能`
- システム: 具体的な名前がない場合のフォールバック

### 非ソフトウェアプロジェクトの場合

責任を持つ主体を選択：

- プロセス/ワークフロー: `採用プロセス`, `品質管理ワークフロー`
- チーム/役割: `営業チーム`, `カスタマーサポート`
- 成果物/ドキュメント: `技術仕様書`, `ユーザーマニュアル`
- キャンペーン: `マーケティングキャンペーン`
- プロトコル: `セキュリティプロトコル`

---

## 良い例と悪い例

### 例1: ユーザー認証

**✓ 良い例**:

```
WHEN ユーザーがログインフォームを送信 THEN 認証サービス SHALL 認証情報を検証
IF 認証情報が正しい THEN 認証サービス SHALL JWTトークンを発行
IF 認証情報が間違っている THEN 認証サービス SHALL エラーメッセージを返す
WHILE ユーザーがログイン中 THE セッション管理サービス SHALL セッション有効性を監視
```

**✗ 悪い例**:

```
システムはユーザーをログインさせる
認証が成功したら、トークンを発行する
セッションを管理する
```

**理由**:

- 悪い例は曖昧で測定不可能
- EARS形式は明確で具体的
- 条件と応答が明確に分離

---

### 例2: データ検証

**✓ 良い例**:

```
WHEN ユーザーがメールアドレスを入力 THEN バリデーションサービス SHALL メールフォーマットを検証
IF メールフォーマットが無効 THEN バリデーションサービス SHALL フィールド横にエラーメッセージを表示
IF メールアドレスが既に登録済み THEN ユーザー管理サービス SHALL 重複エラーを返す
```

**✗ 悪い例**:

```
メールアドレスを検証する
エラーの場合はメッセージを表示
重複チェックを行う
```

**理由**:

- トリガーが不明確
- 条件と応答が混在
- 責任の所在が不明

---

## EARSの書き方のコツ

### 1. 具体的であること

**✓ 良い例**: `THEN 認証サービス SHALL HTTPステータス401を返す`
**✗ 悪い例**: `THEN システム SHALL エラーを返す`

### 2. 測定可能であること

**✓ 良い例**: `THEN システム SHALL 500ms以内にレスポンスを返す`
**✗ 悪い例**: `THEN システム SHALL 速やかにレスポンスを返す`

### 3. テスト可能であること

**✓ 良い例**: `IF パスワードが8文字未満 THEN システム SHALL "パスワードは8文字以上である必要があります"と表示`
**✗ 悪い例**: `パスワードは適切な長さであるべき`

### 4. 一貫した用語を使用

プロジェクト全体で同じ用語を使用：

- `SHALL` を使用（MUST, SHOULD ではなく）
- コンポーネント名を統一
- 動詞を統一（表示する vs 見せる）

### 5. 1つの要件に1つの動作

**✓ 良い例**:

```
WHEN ユーザーがパスワードを入力 THEN システム SHALL パスワード強度を計算
WHEN パスワード強度が計算完了 THEN システム SHALL 強度インジケーターを表示
```

**✗ 悪い例**:

```
WHEN ユーザーがパスワードを入力 THEN システム SHALL パスワード強度を計算して表示
```

---

## 要件ドキュメントでの使用

### 構造

```markdown
## Requirements

### Requirement 1: ユーザー認証

**Objective:** As a ユーザー, I want 安全にログインできる, so that 自分のデータにアクセスできる

#### Acceptance Criteria

1. WHEN ユーザーがログインフォームを送信 THEN 認証サービス SHALL 認証情報を検証
2. IF 認証情報が正しい THEN 認証サービス SHALL JWTトークンを発行
3. IF 認証情報が間違っている THEN 認証サービス SHALL "メールまたはパスワードが正しくありません"と表示
4. WHEN ログイン試行が3回失敗 THEN 認証サービス SHALL アカウントを5分間ロック

### Requirement 2: セッション管理

**Objective:** As a システム, I want セッションを安全に管理できる, so that 不正アクセスを防止できる

#### Acceptance Criteria

1. WHEN ユーザーが正常にログイン THEN セッション管理サービス SHALL 30分の有効期限でセッションを作成
2. WHILE ユーザーがアクティブ THE セッション管理サービス SHALL セッション有効期限を延長
3. WHEN セッションが30分間非アクティブ THEN セッション管理サービス SHALL セッションを無効化してログアウト
```

---

## トラブルシューティング

### 問題: イベントと条件の区別が曖昧

**解決策**:

- WHEN はアクションやイベント（ボタンクリック、タイムアウト）
- IF は状態や前提条件（権限、データの存在）

### 問題: 主語が不明確

**解決策**:

- 具体的なコンポーネント名やサービス名を使用
- プロジェクト全体で主語を統一

### 問題: 要件が測定不可能

**解決策**:

- 具体的な数値や明確な基準を追加
- "速やかに" → "500ms以内に"
- "適切に" → "8文字以上で"

---

## まとめ

EARS形式を使用することで：

1. **明確性**: 曖昧さを排除した要件定義
2. **測定可能性**: すべての要件がテスト可能
3. **一貫性**: プロジェクト全体で統一された形式
4. **トレーサビリティ**: 設計とタスクへの明確なマッピング
5. **品質**: 実装前に要件の問題を発見

cc-sdd では、すべての受入基準を EARS 形式で記述することで、品質の高い要件定義を実現します。
