# cc-sdd ワークフロー詳細

このドキュメントでは、cc-sdd（Claude Code Spec-Driven Development）の完全なワークフローを詳しく説明します。

## ワークフロー概要

cc-sdd は以下の3つのフェーズで構成されます：

1. **Phase 0: Steering（オプショナル）** - プロジェクト全体のガイダンス作成
2. **Phase 1: Specification Creation** - 仕様の段階的作成と承認
3. **Phase 2: Progress Tracking** - 進捗管理と検証

## Phase 0: Steering（オプショナル）

プロジェクト全体のガイドラインとコンテキストを作成・管理するフェーズ。

### いつ実行するか

- **実行推奨**: プロジェクト開始時、大規模な開発の前、重要な技術変更後
- **スキップ可**: 新機能の追加、小規模な変更、既存パターンに従う開発

### コマンド

#### `/kiro:steering`

コアステアリングファイルを作成・更新します：

- `product.md` - プロダクトコンテキストとビジネス目標
- `tech.md` - テクノロジースタックと技術的決定
- `structure.md` - ファイル構成とコードパターン

**実行タイミング**:

- プロジェクト初期設定時
- 重要な技術変更後
- アーキテクチャの大幅な変更後

**動作**:

- 新規ファイルの場合: 包括的な初期コンテンツを生成
- 既存ファイルの場合: ユーザーのカスタマイズを保持しつつ更新

#### `/kiro:steering-custom`

専門的なコンテキストのためのカスタムステアリングファイルを作成します。

**一般的な用途**:

- API標準（`api-standards.md`）
- テストアプローチ（`testing.md`）
- コードスタイルガイドライン（`code-style.md`）
- セキュリティポリシー（`security.md`）
- データベース規約（`database.md`）
- パフォーマンス基準（`performance.md`）
- デプロイメントワークフロー（`deployment.md`）

**インクルージョンモード**:

- **Always**: すべてのコードに適用される普遍的な基準（慎重に使用）
- **Conditional**: 特定のファイルタイプやディレクトリにのみ適用（推奨）
- **Manual**: 必要に応じて `@filename.md` で参照

## Phase 1: Specification Creation

個別機能の仕様を段階的に作成し、各段階で承認を得るフェーズ。

### 1. 仕様の初期化

#### `/kiro:spec-init [詳細な説明]`

新しい仕様の初期化と基本構造の作成を行います。

**実行内容**:

1. プロジェクト説明から機能名を生成
2. `.kiro/specs/[feature-name]/` ディレクトリを作成
3. `spec.json` メタデータファイルを作成
4. `requirements.md` テンプレートを作成

**spec.json の初期状態**:

```json
{
  "feature_name": "[generated-feature-name]",
  "created_at": "current_timestamp",
  "updated_at": "current_timestamp",
  "language": "ja",
  "phase": "initialized",
  "approvals": {
    "requirements": {
      "generated": false,
      "approved": false
    },
    "design": {
      "generated": false,
      "approved": false
    },
    "tasks": {
      "generated": false,
      "approved": false
    }
  },
  "ready_for_implementation": false
}
```

**次のステップ**: `/kiro:spec-requirements [feature-name]`

### 2. 要件定義の生成

#### `/kiro:spec-requirements [feature-name]`

プロジェクト説明に基づいて包括的な要件を生成します。

**コンテキスト読み込み**:

- `.kiro/steering/product.md` - ビジネスコンテキスト
- `.kiro/steering/tech.md` - 技術的制約
- `.kiro/steering/structure.md` - アーキテクチャコンテキスト
- カスタムステアリングファイル（"Always" モード）

**生成内容**:

- EARS形式の要件定義
- 各要件の受入基準
- ユーザーストーリー
- 機能要件と非機能要件

**EARS形式の例**:

- WHEN [イベント/条件] THEN [システム/主語] SHALL [応答]
- IF [前提条件/状態] THEN [システム/主語] SHALL [応答]
- WHILE [継続条件] THE [システム/主語] SHALL [継続動作]
- WHERE [場所/コンテキスト] THE [システム/主語] SHALL [文脈動作]

**承認プロセス**:

1. 生成された要件をレビュー
2. 必要に応じて修正を要求
3. 承認後、`/kiro:spec-design [feature-name] -y` で次へ進む

**次のステップ**: `/kiro:spec-design [feature-name]`

### 3. 技術設計の作成

#### `/kiro:spec-design [feature-name] [-y]`

要件に基づいて技術設計ドキュメントを作成します。

**前提条件**:

- 要件が承認済みであること
- `-y` フラグで要件を自動承認可能

**ファイル処理オプション**:

- design.md が存在しない: 新規作成
- design.md が存在する: 対話的プロンプト
  - [o] Overwrite: 完全に新しい設計を生成
  - [m] Merge: 既存内容を参照コンテキストとして新しい設計を生成
  - [c] Cancel: 手動レビューのため停止

**発見と分析フェーズ**:

1. 機能分類とプロセス適応
2. 要件から技術コンポーネントへのマッピング
3. 既存実装の分析（変更または拡張時）
4. ステアリング整合性チェック
5. 技術と代替案の分析
6. 実装固有の調査（新技術や複雑な統合時）
7. 技術リスク評価

**設計ドキュメント構成**:

- 概要（目的、ユーザー、影響）
- アーキテクチャ（高レベル設計、技術スタック決定）
- システムフロー（シーケンス図、プロセスフロー）
- 要件トレーサビリティ
- コンポーネントとインターフェース
- データモデル
- エラーハンドリング
- テスト戦略
- セキュリティ考慮事項（該当する場合）
- パフォーマンスとスケーラビリティ（該当する場合）

**承認プロセス**:

1. 設計ドキュメントをレビュー
2. アーキテクチャと技術選択を検証
3. 承認後、`/kiro:spec-tasks [feature-name] -y` で次へ進む

**次のステップ**: `/kiro:spec-tasks [feature-name]`

### 4. 実装タスクの生成

#### `/kiro:spec-tasks [feature-name] [-y]`

設計に基づいて詳細な実装タスクを生成します。

**前提条件**:

- 要件と設計が承認済みであること
- `-y` フラグで自動承認可能

**コンテキスト読み込み**:

- `.kiro/specs/[feature-name]/requirements.md`
- `.kiro/specs/[feature-name]/design.md`
- すべてのステアリングファイル（コアとカスタム）

**タスク生成ルール**:

1. **自然言語の説明**: 機能と成果に焦点、コード構造ではない
2. **タスクの統合と進行**: 各タスクは前のタスクの出力に基づく
3. **柔軟なタスクサイズ**: サブタスクは1-3時間、詳細は3-10項目
4. **要件マッピング**: 詳細の末尾に `_Requirements: X.X, Y.Y_`
5. **コードのみに焦点**: コーディング/テストタスクのみ、デプロイやドキュメントは除外

**タスク番号付けルール**（必須）:

- メジャータスク: 1, 2, 3, 4, 5...（連番必須）
- サブタスク: 1.1, 1.2, 2.1, 2.2...（メジャータスクごとにリセット）
- 最大2レベルの階層（1.1.1以降は禁止）

**要件カバレッジチェック**:

- すべての requirements.md の要件がカバーされていることを確認
- すべての要件IDとタスクマッピングをクロスリファレンス
- ギャップが見つかった場合: 要件または設計フェーズに戻る

**承認プロセス**:

1. 生成されたタスクをレビュー
2. タスクサイズと依存関係を検証
3. すべての要件がカバーされていることを確認
4. 承認後、実装を開始

**次のステップ**: 実装の開始

## Phase 2: Progress Tracking

仕様の進捗状況を確認し、整合性を検証するフェーズ。

### 進捗確認

#### `/kiro:spec-status [feature-name]`

仕様の現在のステータスと進捗を表示します。

**表示内容**:

1. **仕様概要**
   - 機能名と説明
   - 作成日と最終更新日
   - 現在のフェーズ
   - 全体完了率

2. **フェーズステータス**
   - Requirements Phase: 完了率、要件数、受入基準
   - Design Phase: 完了率、アーキテクチャ、コンポーネント、図
   - Tasks Phase: 完了率、総タスク数、完了/残り/ブロック中

3. **実装進捗**（実装フェーズの場合）
   - タスク完了内訳
   - 現在のブロッカーや問題
   - 完了までの推定時間
   - 次に必要なアクション

4. **品質メトリクス**
   - 要件カバレッジ
   - 設計完全性
   - タスク粒度
   - 依存関係の解決

5. **推奨事項**
   - 次に取るべきステップ
   - 対処すべき潜在的な問題
   - 提案される改善
   - 完成に必要な欠落要素

6. **ステアリング整合性**
   - アーキテクチャの一貫性
   - 技術スタックのコンプライアンス
   - プロダクト要件との整合

### 検証ツール

#### `/kiro:validate-gap [feature-name]`

要件と既存コードベース間の実装ギャップを分析します。

**実行内容**:

1. 現在の状態調査（既存コードベース分析）
2. 要件実現可能性分析
3. 実装アプローチオプション
4. 技術調査要件
5. 実装複雑度評価

**次のステップ**: `/kiro:spec-design [feature-name]`

#### `/kiro:validate-design [feature-name]`

設計ドキュメントを検証します（詳細は個別コマンドを参照）。

## ワークフローのベストプラクティス

### 承認の重要性

各フェーズで人間の承認を得ることで：

- 誤った方向への進行を防ぐ
- 要件の理解を確認
- 技術的決定を検証
- 実装前の問題を発見

### フェーズスキップの禁止

順序通りに進むことで：

- 設計は承認済み要件に基づく
- タスクは承認済み設計に基づく
- 実装は承認済みタスクに基づく
- 一貫性と品質を維持

### タスクステータスの更新

作業中は常にタスクステータスを更新：

- 作業開始時にタスクを進行中にマーク
- 完了時にタスクを完了としてマーク
- ブロックされた場合は記録

### ステアリングの最新化

重要な変更後はステアリングを更新：

- 新しい技術の導入後
- アーキテクチャパターンの変更後
- プロダクト方向性の変更後

## トラブルシューティング

### 要件が不明確な場合

1. `/kiro:spec-requirements [feature-name]` を再実行
2. 具体的な質問をして明確化
3. ユーザーストーリーを追加
4. 受入基準を詳細化

### 設計が複雑すぎる場合

1. `/kiro:validate-gap [feature-name]` で分析
2. より小さな機能に分割
3. 段階的な実装を検討
4. 代替アプローチを評価

### タスクが大きすぎる場合

1. `/kiro:spec-tasks [feature-name]` を再実行
2. より細かいサブタスクに分割
3. 依存関係を明確化
4. 各タスクを1-3時間以内に収める

## まとめ

cc-sdd ワークフローは、品質の高い開発プロセスを実現するための構造化されたアプローチです。各フェーズを丁寧に進めることで、明確な仕様、適切な設計、実行可能なタスクを得ることができます。
