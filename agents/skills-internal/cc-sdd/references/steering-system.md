# Steering システム詳細

Steeringシステムは、プロジェクト全体のルールとコンテキストでAIをガイドする仕組みです。

## Steering とは

**Steering**（ステアリング）は、プロジェクト全体のガイダンスとコンテキストを提供するドキュメント群です。個別機能の仕様（Specification）とは異なり、プロジェクト横断的な知識と基準を定義します。

### Steering vs Specification

| 項目           | Steering                 | Specification                 |
| -------------- | ------------------------ | ----------------------------- |
| **目的**       | プロジェクト全体のガイド | 個別機能の開発プロセス        |
| **スコープ**   | 全体的・横断的           | 機能単位                      |
| **保存場所**   | `.kiro/steering/`        | `.kiro/specs/[feature-name]/` |
| **更新頻度**   | プロジェクト変更時       | 機能開発ごと                  |
| **コンテンツ** | ルール、基準、パターン   | 要件、設計、タスク            |

## ディレクトリ構造

```
.kiro/steering/
├── product.md          # コアファイル：プロダクトコンテキスト
├── tech.md             # コアファイル：技術スタック
├── structure.md        # コアファイル：ファイル構成
├── api-standards.md    # カスタム：API規約（例）
├── testing.md          # カスタム：テスト方針（例）
└── security.md         # カスタム：セキュリティ基準（例）
```

## コアステアリングファイル

3つのコアファイルは、すべてのプロジェクトで必須です。

### product.md - プロダクトコンテキスト

**目的**: ビジネス的なコンテキストと目標を提供

**含まれる内容**:

- プロダクト概要：プロダクトの簡潔な説明
- コア機能：主要な機能の箇条書き
- ターゲットユースケース：プロダクトが対処する具体的なシナリオ
- 主要な価値提案：独自の利点と差別化要因

**新規ファイルの場合**: 上記すべてのセクションを含む包括的な概要を生成

**既存ファイルの場合**: 以下の変更があった場合のみ更新

- プロダクトに追加された新機能
- 削除された機能や非推奨の機能
- 変更されたユースケースやターゲットオーディエンス
- 更新された価値提案や利点

**インクルージョンモード**: Always（常に含まれる）

### tech.md - テクノロジースタック

**目的**: 技術的な制約と決定を文書化

**含まれる内容**:

- アーキテクチャ：高レベルシステム設計
- フロントエンド：フレームワーク、ライブラリ、ビルドツール（該当する場合）
- バックエンド：言語、フレームワーク、サーバー技術（該当する場合）
- 開発環境：必要なツールとセットアップ
- よく使うコマンド：頻繁に使用する開発コマンド
- 環境変数：重要な設定変数
- ポート設定：サービスが使用する標準ポート

**新規ファイルの場合**: 完全な技術ランドスケープを文書化

**既存ファイルの場合**: 以下の変更を確認

- パッケージマネージャー経由で追加された新しい依存関係
- 削除されたライブラリやフレームワーク
- 主要な依存関係のバージョンアップグレード
- 新しい開発ツールやビルドプロセス
- 変更された環境変数や設定
- 変更されたポート割り当てやサービスアーキテクチャ

**インクルージョンモード**: Always（常に含まれる）

### structure.md - プロジェクト構造

**目的**: コードベースの構成とパターンを説明

**含まれる内容**:

- ルートディレクトリ構成：トップレベル構造と説明
- サブディレクトリ構造：主要ディレクトリの詳細な内訳
- コード構成パターン：コードの構造化方法
- ファイル命名規則：ファイルとディレクトリの命名基準
- インポート構成：インポート/依存関係の構成方法
- 主要なアーキテクチャ原則：コア設計決定とパターン

**新規ファイルの場合**: コードベース構成の概要を作成

**既存ファイルの場合**: 以下の変更を確認

- 新しいディレクトリや大規模な再編成
- 変更されたファイル構成パターン
- 新規または変更された命名規則
- 更新されたアーキテクチャパターンや原則
- リファクタリングされたコード構造やモジュール境界

**インクルージョンモード**: Always（常に含まれる）

## カスタムステアリングファイル

プロジェクト固有のニーズに応じて、カスタムステアリングファイルを追加できます。

### 一般的なカスタムステアリング

#### 1. API Standards (`api-standards.md`)

- REST/GraphQL規約
- エラーハンドリングパターン
- 認証/認可アプローチ
- APIバージョニング戦略

**推奨インクルージョンモード**: Conditional (`src/api/**/*`)

#### 2. Testing Approach (`testing.md`)

- テストファイル構成
- テストの命名規則
- モッキング戦略
- カバレッジ要件
- E2E vs ユニット vs 統合テスト

**推奨インクルージョンモード**: Conditional (`*.test.js`, `*.spec.ts`)

#### 3. Code Style Guidelines (`code-style.md`)

- 言語固有の規約
- リンター以外のフォーマット規則
- コメント基準
- 関数/変数の命名パターン
- コード構成原則

**推奨インクルージョンモード**: Always または Conditional

#### 4. Security Policies (`security.md`)

- 入力検証要件
- 認証パターン
- シークレット管理
- OWASPコンプライアンスガイドライン
- セキュリティレビューチェックリスト

**推奨インクルージョンモード**: Always

#### 5. Database Conventions (`database.md`)

- スキーマ設計パターン
- マイグレーション戦略
- クエリ最適化ガイドライン
- コネクションプーリング設定
- バックアップとリカバリ手順

**推奨インクルージョンモード**: Conditional (`**/models/*`, `**/migrations/*`)

#### 6. Performance Standards (`performance.md`)

- ロード時間要件
- メモリ使用制限
- 最適化技術
- キャッシング戦略
- モニタリングとプロファイリング

**推奨インクルージョンモード**: Manual または Conditional

#### 7. Deployment Workflow (`deployment.md`)

- CI/CDパイプラインステージ
- 環境設定
- リリース手順
- ロールバック戦略
- ヘルスチェック要件

**推奨インクルージョンモード**: Manual

## インクルージョンモード

カスタムステアリングファイルは、3つのインクルージョンモードのいずれかで設定できます。

### 1. Always（常時含む）

**説明**: すべてのインタラクションで読み込まれる

**使用タイミング**:

- すべてのコードに適用される普遍的な基準
- セキュリティポリシーなどの重要な要件
- プロジェクト全体に影響する決定

**例**:

- `security-standards.md` - 重要なセキュリティ要件
- `code-style.md` - プロジェクト全体のコーディング規約

**注意**: コアファイル以外ではできるだけ控えめに使用。すべてのインタラクションでコンテキストサイズが増加します。

### 2. Conditional（条件付き含む）

**説明**: 特定のファイルパターンにマッチする場合のみ読み込まれる

**使用タイミング**:

- ドメイン固有のガイドライン
- 特定のファイルタイプやディレクトリに適用される規則

**ファイルパターン例**:

- `*.test.js` - JavaScriptテストファイル
- `src/api/**/*` - APIディレクトリ内のすべてのファイル
- `**/auth/*` - 認証関連ファイル
- `*.config.*` - 設定ファイル

**例**:

- `testing-approach.md` + パターン `*.test.js, *.spec.ts`
- `api-standards.md` + パターン `src/api/**/*`

**利点**: 関連するコンテキストを提供しつつ、一般的なインタラクションを圧迫しない

**推奨**: ほとんどのカスタムファイルにはこのモードを使用

### 3. Manual（手動参照）

**説明**: 必要に応じて `@filename.md` 構文で参照

**使用タイミング**:

- 特定のタスクでのみ必要な専門知識
- 頻繁には参照されないドキュメント

**例**:

- `deployment-runbook.md` - デプロイメント固有のタスク用
- `migration-guide.md` - データマイグレーション時のみ必要

**利点**: 必要な時に利用可能、日常的なインタラクションを圧迫しない

## ステアリングの作成と更新

### コマンド

#### `/kiro:steering`

コアステアリングファイルを作成または更新します。

**動作**:

1. **既存ファイルチェック**: 各コアファイルの存在を確認
2. **プロジェクト分析**: 現在のコードベース、設定、ドキュメントを分析
3. **スマート更新戦略**:
   - 新規ファイル: 包括的な初期コンテンツを生成
   - 既存ファイル: ユーザーのカスタマイズを保持しつつ更新

**保持される内容**（既存ファイルの場合）:

- ユーザーのカスタマイズとコメント
- 標準テンプレートにないセクション
- ユーザーが追加した例
- インラインコメントやノート
- フォーマットの好み

**更新される内容**（既存ファイルの場合）:

- 依存関係とバージョン
- ファイル構造
- コマンド
- 新しい機能や変更

**実行タイミング**:

- プロジェクト初期設定時
- 重要な変更後
- 技術スタックの大幅な更新後

#### `/kiro:steering-custom`

カスタムステアリングファイルを作成します。

**対話的プロセス**:

1. ドキュメント名の入力を求める
2. トピック/目的の説明を求める
3. インクルージョンモードの選択を求める
4. Conditionalの場合、パターンの指定を求める

**ドキュメント構造**:

```markdown
<!-- Inclusion Mode: Always | Conditional: "pattern" | Manual -->

# [タイトル]

## 目的

[このドキュメントが扱うプロジェクトの側面]
[このガイダンスをいつ適用すべきか]

## ガイドライン

[従うべき具体的なルールとパターン]
[重要な決定の根拠]

## コード例

[正しい実装パターンを示す]
[役立つ場合は反例も含める]

## 統合ポイント

[他のステアリングドキュメントとの関係]
[依存関係や前提条件]
```

## セキュリティとプライバシー

### セキュリティ要件

**絶対に含めてはいけないもの**:

- APIキー、パスワード、データベースURL、シークレット
- 内部サーバー名、プライベートAPIエンドポイント
- 個人情報や機密ビジネス情報

**レビューすべき内容**:

- すべてのステアリングコンテンツを確認してからバージョン管理にコミット
- ステアリングファイルはプロジェクトのすべての協力者と共有されることを忘れない

### コンテンツ品質基準

**単一責任**:

- 1つのステアリングファイル = 1つのドメイン
- APIとデータベースのガイドラインを混在させない

**具体的な例**:

- コードスニペットと実際のプロジェクト例を含める
- 抽象的な原則よりも具体的な実装可能なガイドライン

**明確な根拠**:

- なぜ特定のアプローチが推奨されるのかを説明
- トレードオフと代替案を文書化

**保守可能なサイズ**:

- ファイルあたり2-3分の読書時間を目標
- 詳細すぎる場合は複数のファイルに分割

## ベストプラクティス

### 作成時

1. **コアファイルから始める**: まず product.md、tech.md、structure.md を作成
2. **必要に応じて拡張**: 明確なニーズがある場合のみカスタムファイルを追加
3. **重複を避ける**: 情報は1つの場所にのみ存在すべき
4. **具体的に**: 曖昧な表現ではなく、実行可能な指示を提供

### 更新時

1. **定期的にレビュー**: 重要なプロジェクト変更後に更新
2. **増分的に**: 大幅な書き直しではなく、段階的に改善
3. **非推奨をマーク**: 削除ではなく、打ち消し線や [DEPRECATED] タグを使用
4. **変更を日付記録**: 大きな変更にはタイムスタンプを追加

### 使用時

1. **ステアリングを信頼**: AIはステアリングの内容に従う
2. **矛盾を解決**: 異なるステアリングファイル間の矛盾を見つけたら修正
3. **フィードバックループ**: ステアリングが役立たない場合は更新

## まとめ

Steeringシステムは、プロジェクト全体の一貫性と品質を維持するための基盤です。コアファイルで基本を確立し、カスタムファイルで専門的なニーズに対応することで、AIが常にプロジェクトのコンテキストと基準を理解した状態で作業できます。
