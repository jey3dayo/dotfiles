# ãƒ‡ãƒ¼ã‚¿ã‚½ãƒ¼ã‚¹çµ±åˆ

Todo Orchestratorã¯**TodoWrite**ã¨**.claude/TODO.md**ã®2ã¤ã®ãƒ‡ãƒ¼ã‚¿ã‚½ãƒ¼ã‚¹ã‚’çµ±åˆç®¡ç†ã—ã¾ã™ã€‚

## ãƒ‡ãƒ¼ã‚¿ã‚½ãƒ¼ã‚¹æ¯”è¼ƒ

| ç‰¹å¾´           | TodoWrite               | .claude/TODO.md     |
| -------------- | ----------------------- | ------------------- |
| ã‚¹ã‚³ãƒ¼ãƒ—       | ã‚»ãƒƒã‚·ãƒ§ãƒ³å†…            | ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå…¨ä½“    |
| æ°¸ç¶šæ€§         | ä¸€æ™‚çš„                  | æ°¸ç¶šçš„              |
| ç·¨é›†æ–¹æ³•       | ãƒ„ãƒ¼ãƒ«çµŒç”±              | äººé–“ãŒç›´æ¥ç·¨é›†å¯èƒ½  |
| ãƒãƒ¼ã‚¸ãƒ§ãƒ³ç®¡ç† | ãªã—                    | Gitç®¡ç†å¯èƒ½         |
| ä¸»ãªç”¨é€”       | å³åº§å®Ÿè¡Œã‚¿ã‚¹ã‚¯ï¼ˆP1-P2ï¼‰ | é•·æœŸã‚¿ã‚¹ã‚¯ï¼ˆP3-P5ï¼‰ |
| æ›´æ–°é »åº¦       | ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ             | å¿…è¦æ™‚ã«åŒæœŸ        |

## TodoWriteï¼ˆã‚»ãƒƒã‚·ãƒ§ãƒ³å†…ï¼‰

### ç‰¹å¾´

```python
# ã‚»ãƒƒã‚·ãƒ§ãƒ³å†…ã§å³åº§ã«åˆ©ç”¨å¯èƒ½
TodoWrite([
    {
        "content": "Fix validation bug",
        "priority": "high",
        "status": "pending"
    }
])

# ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æ›´æ–°
TodoWrite([
    {
        "content": "Fix validation bug",
        "priority": "high",
        "status": "completed"  # ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹æ›´æ–°
    }
])
```

### ä½¿ç”¨ã‚¿ã‚¤ãƒŸãƒ³ã‚°

- å³åº§å®Ÿè¡Œã‚¿ã‚¹ã‚¯ï¼ˆP1-P2ï¼‰: ä¼šè©±ä¸­ã«ç”Ÿã¾ã‚ŒãŸçŸ­æœŸã‚¿ã‚¹ã‚¯
- ã‚»ãƒƒã‚·ãƒ§ãƒ³å›ºæœ‰ã‚¿ã‚¹ã‚¯: ç¾åœ¨ã®ä¼šè©±ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã«ä¾å­˜
- ä¸€æ™‚çš„ãªãƒ¡ãƒ¢: å®Ÿè¡Œå¾Œã«å‰Šé™¤ã—ã¦ã‚‚è‰¯ã„ã‚¿ã‚¹ã‚¯

### ãƒ¡ãƒªãƒƒãƒˆ

- ãƒ„ãƒ¼ãƒ«å‘¼ã³å‡ºã—ã§å³åº§ã«åˆ©ç”¨å¯èƒ½
- ã‚»ãƒƒã‚·ãƒ§ãƒ³å†…ã§é«˜é€Ÿã«ã‚¢ã‚¯ã‚»ã‚¹
- ä¼šè©±ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã¨å¯†çµåˆ

### ãƒ‡ãƒ¡ãƒªãƒƒãƒˆ

- ã‚»ãƒƒã‚·ãƒ§ãƒ³çµ‚äº†ã§æ¶ˆå¤±
- ãƒãƒ¼ã‚¸ãƒ§ãƒ³ç®¡ç†ä¸å¯
- äººé–“ãŒç›´æ¥ç·¨é›†ä¸å¯

## .claude/TODO.mdï¼ˆæ°¸ç¶šçš„ï¼‰

### ç‰¹å¾´

```markdown
# TODO

## ğŸŸ  P3: Refactor auth module (1d)

**æ¨å®šå·¥æ•°**: 8æ™‚é–“
**å„ªå…ˆåº¦**: P3 (æ…é‡å®Ÿè¡Œ)
**ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹**: pending

### è¦ä»¶

- ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«åˆ†å‰²
- ãƒ†ã‚¹ãƒˆã‚«ãƒãƒ¬ãƒƒã‚¸å‘ä¸Š
- ä¾å­˜é–¢ä¿‚æ•´ç†

### å½±éŸ¿ç¯„å›²

- auth/\*
- tests/auth/\*

## ğŸŸ¦ P4: Implement SSO integration (2d)

**æ¨å®šå·¥æ•°**: 16æ™‚é–“
**å„ªå…ˆåº¦**: P4 (çµ±åˆå®Ÿè¡Œ)
**ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹**: blocked
**ä¾å­˜**: Refactor auth module

### è¦ä»¶

- OAuth2.0çµ±åˆ
- SAMLå¯¾å¿œ
- æ—¢å­˜èªè¨¼ã¨ã®çµ±åˆ
```

### ä½¿ç”¨ã‚¿ã‚¤ãƒŸãƒ³ã‚°

- é•·æœŸã‚¿ã‚¹ã‚¯ï¼ˆP3-P5ï¼‰: è¤‡æ•°ã‚»ãƒƒã‚·ãƒ§ãƒ³ã«ã¾ãŸãŒã‚‹ã‚¿ã‚¹ã‚¯
- ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå…¨ä½“ã‚¿ã‚¹ã‚¯: ãƒãƒ¼ãƒ å…¨ä½“ã§å…±æœ‰ã™ã‚‹ã‚¿ã‚¹ã‚¯
- ãƒãƒƒã‚¯ãƒ­ã‚°: å°†æ¥å®Ÿè¡Œäºˆå®šã®ã‚¿ã‚¹ã‚¯

### ãƒ¡ãƒªãƒƒãƒˆ

- ã‚»ãƒƒã‚·ãƒ§ãƒ³çµ‚äº†å¾Œã‚‚æ°¸ç¶šåŒ–
- Gitç®¡ç†ã§ãƒãƒ¼ã‚¸ãƒ§ãƒ³å±¥æ­´ä¿å­˜
- äººé–“ãŒç›´æ¥ç·¨é›†å¯èƒ½ï¼ˆMarkdownï¼‰
- ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå…¨ä½“ã§å…±æœ‰å¯èƒ½

### ãƒ‡ãƒ¡ãƒªãƒƒãƒˆ

- ãƒ•ã‚¡ã‚¤ãƒ«èª­ã¿æ›¸ããŒå¿…è¦
- æ‰‹å‹•åŒæœŸãŒå¿…è¦ãªå ´åˆã‚ã‚Š

## çµ±åˆè¡¨ç¤º

### èª­ã¿è¾¼ã¿å‡¦ç†

```python
def load_integrated_tasks():
    """ä¸¡ãƒ‡ãƒ¼ã‚¿ã‚½ãƒ¼ã‚¹ã‹ã‚‰çµ±åˆã‚¿ã‚¹ã‚¯ä¸€è¦§ã‚’ç”Ÿæˆ"""

    # 1. TodoWriteã‹ã‚‰å–å¾—
    session_tasks = TodoWrite.get_all()

    # 2. .claude/TODO.mdã‹ã‚‰å–å¾—
    persistent_tasks = []
    if os.path.exists('.claude/TODO.md'):
        persistent_tasks = parse_todo_md('.claude/TODO.md')

    # 3. çµ±åˆãƒ»é‡è¤‡æ’é™¤
    merged = merge_tasks(session_tasks, persistent_tasks)

    # 4. å„ªå…ˆåº¦ã‚½ãƒ¼ãƒˆ
    sorted_tasks = sort_by_priority(merged)

    return sorted_tasks
```

### é‡è¤‡æ’é™¤

```python
def merge_tasks(session_tasks, persistent_tasks):
    """ã‚¿ã‚¹ã‚¯ã‚’çµ±åˆã—ã€é‡è¤‡ã‚’æ’é™¤"""

    merged = []
    seen_ids = set()

    # 1. ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚¿ã‚¹ã‚¯å„ªå…ˆï¼ˆæœ€æ–°ï¼‰
    for task in session_tasks:
        task_id = task.get('id') or generate_id_from_content(task)
        if task_id not in seen_ids:
            task['source'] = 'TodoWrite'
            merged.append(task)
            seen_ids.add(task_id)

    # 2. æ°¸ç¶šã‚¿ã‚¹ã‚¯è¿½åŠ ï¼ˆé‡è¤‡é™¤å¤–ï¼‰
    for task in persistent_tasks:
        task_id = task.get('id') or generate_id_from_content(task)
        if task_id not in seen_ids:
            task['source'] = 'TODO.md'
            merged.append(task)
            seen_ids.add(task_id)

    return merged


def generate_id_from_content(task):
    """ã‚¿ã‚¹ã‚¯å†…å®¹ã‹ã‚‰IDã‚’ç”Ÿæˆï¼ˆé‡è¤‡åˆ¤å®šç”¨ï¼‰"""
    import hashlib

    # ã‚¿ã‚¤ãƒˆãƒ« + å½±éŸ¿ãƒ•ã‚¡ã‚¤ãƒ«ã§ãƒãƒƒã‚·ãƒ¥ç”Ÿæˆ
    content = f"{task.get('title', task.get('content', ''))}"
    if 'files_affected' in task:
        content += '|' + '|'.join(sorted(task['files_affected']))

    return hashlib.md5(content.encode()).hexdigest()[:8]
```

### å„ªå…ˆåº¦ã‚½ãƒ¼ãƒˆ

```python
def sort_by_priority(tasks):
    """å„ªå…ˆåº¦ã§ã‚½ãƒ¼ãƒˆï¼ˆP1 â†’ P5ï¼‰"""

    priority_order = {
        'P1': 1,
        'P2': 2,
        'P3': 3,
        'P4': 4,
        'P5': 5
    }

    def get_priority_value(task):
        priority = task.get('priority', 'P3')
        return priority_order.get(priority, 3)

    return sorted(tasks, key=get_priority_value)
```

### è¡¨ç¤ºä¾‹

```
=== çµ±åˆã‚¿ã‚¹ã‚¯ä¸€è¦§ ===
Source: TodoWrite (4) + TODO.md (2)

[1] ğŸŸ¢ P1 | Fix validation bug (1h) [TodoWrite]
[2] ğŸŸ¢ P1 | Update error messages (30m) [TodoWrite]
[3] ğŸŸ¡ P2 | Add profile page (4h) [TodoWrite]
[4] ğŸŸ  P3 | Refactor auth module (1d) [TODO.md]
[5] ğŸŸ¦ P4 | SSO integration (2d) [TODO.md] [blocked]
[6] ğŸ”´ P5 | DB migration (1w) [TODO.md]
```

## åŒæœŸæ©Ÿèƒ½

### æ‰‹å‹•åŒæœŸ

```bash
# TodoWrite â†’ .claude/TODO.md ã«ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ
todo-orchestrator --sync export

# .claude/TODO.md â†’ TodoWrite ã«ã‚¤ãƒ³ãƒãƒ¼ãƒˆ
todo-orchestrator --sync import

# åŒæ–¹å‘åŒæœŸï¼ˆãƒãƒ¼ã‚¸ï¼‰
todo-orchestrator --sync merge
```

### è‡ªå‹•åŒæœŸ

```python
def auto_sync_on_completion(task):
    """ã‚¿ã‚¹ã‚¯å®Œäº†æ™‚ã«è‡ªå‹•åŒæœŸ"""

    if task.source == 'TodoWrite':
        # TodoWriteã‚¿ã‚¹ã‚¯ãŒå®Œäº†ã—ãŸã‚‰.claude/TODO.mdã‚‚æ›´æ–°
        update_todo_md(task, status='completed')

    elif task.source == 'TODO.md':
        # .claude/TODO.mdã‚¿ã‚¹ã‚¯ãŒå®Œäº†ã—ãŸã‚‰TodoWriteã‚‚æ›´æ–°
        TodoWrite.update(task, status='completed')


def auto_sync_on_add(task):
    """ã‚¿ã‚¹ã‚¯è¿½åŠ æ™‚ã«è‡ªå‹•åŒæœŸ"""

    # P3ä»¥ä¸Šã®é•·æœŸã‚¿ã‚¹ã‚¯ã¯.claude/TODO.mdã«ã‚‚è¨˜éŒ²
    if task.priority in ['P3', 'P4', 'P5']:
        append_to_todo_md(task)

    # P1-P2ã¯TodoWriteã®ã¿ï¼ˆã‚»ãƒƒã‚·ãƒ§ãƒ³å†…ã§å®Œçµï¼‰
```

### ç«¶åˆè§£æ±º

```python
def resolve_conflict(task_todowrite, task_md):
    """åŒã˜ã‚¿ã‚¹ã‚¯ãŒä¸¡æ–¹ã«å­˜åœ¨ã™ã‚‹å ´åˆã®ç«¶åˆè§£æ±º"""

    # 1. æ›´æ–°æ—¥æ™‚ã§æœ€æ–°ã‚’åˆ¤å®š
    if task_todowrite.updated_at > task_md.updated_at:
        print(f"âš ï¸  TodoWriteã®æ–¹ãŒæ–°ã—ã„ãŸã‚ã€TODO.mdã‚’ä¸Šæ›¸ãã—ã¾ã™")
        return task_todowrite

    elif task_md.updated_at > task_todowrite.updated_at:
        print(f"âš ï¸  TODO.mdã®æ–¹ãŒæ–°ã—ã„ãŸã‚ã€TodoWriteã‚’ä¸Šæ›¸ãã—ã¾ã™")
        return task_md

    # 2. åŒã˜æ›´æ–°æ—¥æ™‚ã®å ´åˆã¯æ‰‹å‹•ãƒãƒ¼ã‚¸
    else:
        print(f"âš ï¸  ç«¶åˆæ¤œå‡º: {task_todowrite.title}")
        print(f"[1] TodoWrite: {task_todowrite.status}")
        print(f"[2] TODO.md: {task_md.status}")
        choice = input("ã©ã¡ã‚‰ã‚’æ¡ç”¨ã—ã¾ã™ã‹? (1/2/merge): ")

        if choice == '1':
            return task_todowrite
        elif choice == '2':
            return task_md
        else:
            return merge_manually(task_todowrite, task_md)
```

## ä½¿ã„åˆ†ã‘ã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³

### TodoWriteæ¨å¥¨

```
âœ“ å³åº§å®Ÿè¡Œã‚¿ã‚¹ã‚¯ï¼ˆP1-P2ï¼‰
âœ“ ä¼šè©±ä¸­ã«ç”Ÿã¾ã‚ŒãŸçŸ­æœŸã‚¿ã‚¹ã‚¯
âœ“ ã‚»ãƒƒã‚·ãƒ§ãƒ³å†…ã§å®Œçµã™ã‚‹ã‚¿ã‚¹ã‚¯
âœ“ ä¸€æ™‚çš„ãªãƒ¡ãƒ¢ãƒ»ãƒªãƒã‚¤ãƒ³ãƒ€ãƒ¼
```

### .claude/TODO.mdæ¨å¥¨

```
âœ“ é•·æœŸã‚¿ã‚¹ã‚¯ï¼ˆP3-P5ï¼‰
âœ“ ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå…¨ä½“ã§å…±æœ‰ã™ã‚‹ã‚¿ã‚¹ã‚¯
âœ“ ãƒãƒƒã‚¯ãƒ­ã‚°ãƒ»å°†æ¥è¨ˆç”»
âœ“ ãƒãƒ¼ãƒ å…¨ä½“ã§ç®¡ç†ã™ã‚‹ã‚¿ã‚¹ã‚¯
âœ“ Gitå±¥æ­´ã¨ã—ã¦æ®‹ã—ãŸã„ã‚¿ã‚¹ã‚¯
```

### ä¸¡æ–¹åˆ©ç”¨

```
âœ“ P3ä»¥ä¸Šã®é•·æœŸã‚¿ã‚¹ã‚¯ â†’ ä¸¡æ–¹ã«è¨˜éŒ²
âœ“ æ®µéšçš„ã‚¿ã‚¹ã‚¯ â†’ ã‚µãƒ–ã‚¿ã‚¹ã‚¯ã¯TodoWriteã€è¦ªã‚¿ã‚¹ã‚¯ã¯.claude/TODO.md
âœ“ ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆç§»è¡Œä¸­ â†’ ä¸€æ™‚çš„ã«ä¸¡æ–¹ã§ç®¡ç†
```

## ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹

### 1. å®šæœŸçš„ãªåŒæœŸ

```bash
# é€±æ¬¡ã§TodoWrite â†’ .claude/TODO.mdã«ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ
todo-orchestrator --sync export

# å®Œäº†ã‚¿ã‚¹ã‚¯ã¯ã‚¢ãƒ¼ã‚«ã‚¤ãƒ–
todo-orchestrator --archive completed
```

### 2. å„ªå…ˆåº¦ã«å¿œã˜ãŸä½¿ã„åˆ†ã‘

```python
def choose_data_source(task):
    """å„ªå…ˆåº¦ã§ãƒ‡ãƒ¼ã‚¿ã‚½ãƒ¼ã‚¹ã‚’è‡ªå‹•é¸æŠ"""

    if task.priority in ['P1', 'P2']:
        # å³åº§å®Ÿè¡Œ â†’ TodoWrite
        return DataSource.TODO_WRITE

    elif task.priority in ['P3', 'P4', 'P5']:
        # é•·æœŸå®Ÿè¡Œ â†’ .claude/TODO.md
        return DataSource.TODO_MD

    else:
        # ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã¯TodoWrite
        return DataSource.TODO_WRITE
```

### 3. æ˜ç¢ºãªå‘½åè¦å‰‡

```markdown
# .claude/TODO.md

## Active Tasksï¼ˆé€²è¡Œä¸­ï¼‰

### ğŸŸ¢ P1-P2: å³åº§å®Ÿè¡Œï¼ˆã‚»ãƒƒã‚·ãƒ§ãƒ³å†…ï¼‰

ï¼ˆTodoWriteã¨åŒæœŸï¼‰

### ğŸŸ  P3: æ…é‡å®Ÿè¡Œï¼ˆ1-2æ—¥ï¼‰

- [ ] Refactor auth module

### ğŸŸ¦ P4: çµ±åˆå®Ÿè¡Œï¼ˆ2-4æ—¥ï¼‰

- [ ] SSO integration

## Backlogï¼ˆãƒãƒƒã‚¯ãƒ­ã‚°ï¼‰

### ğŸ”´ P5: è¨ˆç”»å®Ÿè¡Œï¼ˆ1é€±é–“ä»¥ä¸Šï¼‰

- [ ] Database migration
```

### 4. ã‚³ãƒ¡ãƒ³ãƒˆã§åŒæœŸçŠ¶æ…‹ã‚’è¨˜éŒ²

```markdown
<!-- TodoWrite Sync: 2024-01-15 10:30 -->

## Active Tasks

- [x] Fix validation bug (TodoWrite: completed)
- [ ] Refactor auth module (TODO.md: pending)
```

## ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### åŒæœŸã‚¨ãƒ©ãƒ¼

```bash
# åŒæœŸçŠ¶æ…‹ç¢ºèª
todo-orchestrator --sync status

# å¼·åˆ¶åŒæœŸï¼ˆç«¶åˆã‚’ä¸Šæ›¸ãï¼‰
todo-orchestrator --sync force-export  # TodoWriteå„ªå…ˆ
todo-orchestrator --sync force-import  # TODO.mdå„ªå…ˆ

# ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ä½œæˆ
todo-orchestrator --backup
```

### é‡è¤‡ã‚¿ã‚¹ã‚¯

```bash
# é‡è¤‡æ¤œå‡º
todo-orchestrator --check-duplicates

# è‡ªå‹•ãƒãƒ¼ã‚¸
todo-orchestrator --merge-duplicates

# æ‰‹å‹•ç¢ºèª
todo-orchestrator --list-duplicates
```

### ãƒ‡ãƒ¼ã‚¿æ•´åˆæ€§

```bash
# æ•´åˆæ€§ãƒã‚§ãƒƒã‚¯
todo-orchestrator --validate

# è‡ªå‹•ä¿®å¾©
todo-orchestrator --repair
```
