# コードレビュー - Dotfiles設定品質評価

ステージング中の変更またはファイルパターンを対象に、dotfiles特化の品質評価を5段階で実行します。

## 使用方法

```bash
/code-review [オプション]
```

**オプション**:

- `--files [pattern]`: 特定ファイルパターンをレビュー (例: `zsh/*`, `nvim/*.lua`)
- `--focus [layer]`: 特定層に特化したレビュー (`shell`, `editor`, `terminal`, `git`)
- `--performance`: パフォーマンス影響を重点評価
- `--staged`: git staged変更のみレビュー（デフォルト）

## 評価システム ⭐️

### 5段階評価基準

- **⭐️⭐️⭐️⭐️⭐️ (5/5)**: 模範的設定 - 他の参考になる優秀な品質
- **⭐️⭐️⭐️⭐️☆ (4/5)**: 良好な設定 - dotfiles基準に適合した高品質
- **⭐️⭐️⭐️☆☆ (3/5)**: 標準的設定 - 基本要件を満たした実装
- **⭐️⭐️☆☆☆ (2/5)**: 改善推奨 - パフォーマンス・品質に課題あり
- **⭐️☆☆☆☆ (1/5)**: 要見直し - 根本的な設定見直しが必要

### 評価観点

1. **パフォーマンス影響** - Zsh起動時間・Neovim読み込み速度への影響
2. **設定品質** - モジュール化・可読性・保守性
3. **統合パターン** - ツール間連携・層境界の適切性
4. **ポータビリティ** - 環境依存・互換性考慮
5. **実用性** - 実際の開発効率向上への寄与

## 実行フロー

### 📊 基本レビュー流れ

1. **変更ファイル検出** - `git diff --cached`または指定パターンで対象特定
2. **層別分析** - Shell/Editor/Terminal/Gitの該当層での影響評価
3. **パフォーマンス評価** - 起動時間・レスポンス時間への影響チェック
4. **統合パターン確認** - 他ツールとの連携パターン妥当性評価
5. **改善提案生成** - 具体的な修正案と優先度提示

### 🎯 層別評価ポイント

#### Shell層 (Zsh関連)

- **起動時間**: 新しい設定による遅延増加の有無
- **プラグイン管理**: Sheldon設定の適切性
- **遅延読み込み**: mise等重い処理の最適化状況

#### Editor層 (Neovim関連)

- **LSP設定**: クライアント管理・重複回避の適切性
- **プラグイン**: lazy.nvim最適化・必要性の妥当性
- **キーマップ**: 統一パターン・競合回避

#### Terminal層 (WezTerm/Tmux/Alacritty)

- **設定構造**: Lua設定の適切な分離・モジュール化
- **パフォーマンス**: GPU加速・レンダリング最適化
- **統合**: Shell・Editorとの連携適切性

#### Git層

- **ワークフロー**: 設定によるGit操作効率化
- **セキュリティ**: 認証設定・秘匿情報管理
- **統合**: GUI・CUIツールとの連携

## 📋 レポート形式

```markdown
# 📝 Dotfiles レビュー結果

## 🌟 総合評価: ⭐️⭐️⭐️⭐️☆ (4/5)

### 📊 層別評価

- **Shell** (zsh/): ⭐️⭐️⭐️⭐️⭐️ (5/5) - 起動時間最適化済み
- **Editor** (nvim/): ⭐️⭐️⭐️⭐️☆ (4/5) - LSP設定良好、軽微改善余地
- **Terminal** (wezterm/): ⭐️⭐️⭐️☆☆ (3/5) - 設定整理推奨
- **Git**: ⭐️⭐️⭐️⭐️⭐️ (5/5) - 統合パターン優秀

### 🎯 主要改善点

1. **パフォーマンス** - WezTerm設定で3箇所の最適化機会
2. **統合パターン** - Editor-Terminal間のキーバインド統一
3. **保守性** - 設定ファイル分割による管理性向上

### ✅ 推奨アクション

1. WezTerm Lua設定のモジュール分離 (優先度: 高)
2. Neovim LSPクライアント重複制御の改善 (優先度: 中)
3. 起動時間再測定とベンチマーク更新 (優先度: 低)
```

## 🔧 パフォーマンス重点評価

### 起動時間チェック項目

- **Zsh**: 新しいプラグイン・設定による遅延追加
- **Neovim**: lazy.nvim最適化・LSPクライアント起動効率
- **WezTerm**: Lua設定処理時間・GPU設定最適化

### メモリ使用量評価

- プラグイン・機能追加によるメモリ消費増加
- 不要な機能・重複設定の特定

## ⚠️ 制約・注意事項

### 🎯 Non-Destructive Review

- ファイル変更は行わず、分析・提案のみ実行
- 修正実装は別途手動またはリファクタリングコマンドで対応

### 🔍 Dotfiles特化評価

- 一般的コード品質より、dotfiles環境での実用性を重視
- 個人利用前提での最適化・カスタマイズ妥当性を評価

### 📝 Layer-Aware Analysis

- CLAUDE.mdの層別アーキテクチャに基づいた適切性評価
- 層境界違反・設定の不適切な配置の検出

## 🚀 高速実行重視

- 外部ツール依存なし（TypeScript・ESLint実行しない）
- git操作とファイル読み込みのみで軽量動作
- 1分以内でのレビュー完了を目標

## 📋 品質チェックリスト

- [ ] 対象ファイルの層別分類適切性
- [ ] パフォーマンス影響の定量評価
- [ ] 統合パターンの妥当性確認
- [ ] 改善提案の具体性・実行可能性
- [ ] 5段階評価の根拠明確化

## 🔗 関連コマンド

- **/refactoring** - レビュー結果に基づく設定改善実行
- **/learnings** - レビューで得た知見の層別記録
- `zsh-benchmark` - Zsh起動時間測定
- `git diff --cached` - ステージング変更確認

## 🚀 改善実行プロンプト

レビュー完了後、改善提案がある場合は必ず以下を確認：

```
改善提案を実行しますか？ (Y/n): 
```

- **Y/y/Enter**: 提案された改善を順次実行
- **n/N**: レビューのみで終了
- **選択的実行**: 特定の改善項目番号を指定（例: 1,3）

---

**注意**: dotfiles環境に特化した軽量・実用重視のレビューシステムです。
