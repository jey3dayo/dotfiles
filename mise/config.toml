# ========================================
# グローバル mise 設定（ツール・共通設定のみ）
# ~/.config/mise/config.toml
# ========================================

[settings]
env_file = '.env'
experimental = true
jobs = 8  # デフォルトの並列実行数
vfox = false
idiomatic_version_file_enable_tools = ["go"]
trusted_config_paths = ["~/src/github.com", "/private/var/folders"]

[env]
_.source = [".venv/bin/activate"]
YAMLLINT_CONFIG_FILE = "yamllint/config"
MD_GLOB = "'**/*.md'"
MD_EXCLUDES = "'#node_modules' '#tmux/plugins' '#fisher' '#zsh/.zinit'"

[tools]
actionlint = "latest"     # GitHub Actions workflow lint
biome = "latest"
fd = "latest"
go = "1.23.3"
node = "22.20.0"
prettier = "latest"
stylua = "latest"
shfmt = "latest"
luajit = "latest"
yamllint = "latest"       # YAML lint
"npm:markdownlint-cli2" = "latest"
"npm:markdown-link-check" = "latest"
taplo = "latest"

[tasks."format:biome"]
description = "JS/TS/JSON ファイルをフォーマット"
run = "biome format --write ."

[tasks."format:biome:check"]
description = "JS/TS/JSON ファイルのフォーマットチェック（書き込みなし）"
run = "biome check --formatter-enabled=true --linter-enabled=false ."

[tasks."format:markdown"]
description = "Markdown ファイルをフォーマット"
run = [
  "markdownlint-cli2 --fix ${MD_GLOB} ${MD_EXCLUDES}",
  "fd -e md -X prettier --write",
]

[tasks."format:markdown:check"]
description = "Markdown ファイルのフォーマットチェック（書き込みなし）"
run = "fd -e md -X prettier --check"

[tasks."format:yaml"]
description = "YAML ファイルをフォーマット"
run = "fd -e yml -e yaml -X prettier --write"

[tasks."format:yaml:check"]
description = "YAML ファイルのフォーマットチェック（書き込みなし）"
run = "fd -e yml -e yaml -X prettier --check"

[tasks."format:lua"]
description = "Lua ファイルをフォーマット"
run = "stylua ."

[tasks."format:lua:check"]
description = "Lua ファイルのフォーマットチェック（書き込みなし）"
run = "stylua --check ."

[tasks."format:shell"]
description = "シェルスクリプトをフォーマット"
run = "fd -e sh -X shfmt -w"

[tasks."format:shell:check"]
description = "シェルスクリプトのフォーマットチェック（書き込みなし）"
run = "fd -e sh -X shfmt -d"

[tasks."format:toml"]
description = "TOML ファイルをフォーマット"
run = "taplo format ."

[tasks."format:toml:check"]
description = "TOML ファイルのフォーマットチェック（書き込みなし）"
run = "taplo format --check ."

[tasks."format:docs"]
description = "ドキュメントの完全な検証とフォーマット"
depends = ["format:markdown", "lint:links", "lint:yaml"]

[tasks."lint:docs"]
description = "ドキュメント全体の検証（lint + リンク + YAML）"
depends = ["lint:markdown", "lint:links", "lint:yaml"]

[tasks."lint:biome"]
description = "JS/TS/JSON ファイルをチェック"
run = "biome check ."

[tasks."lint:markdown"]
description = "Markdown ファイルをチェック"
run = [
  "markdownlint-cli2 ${MD_GLOB} ${MD_EXCLUDES}",
  "fd -e md -X prettier --check",
]

[tasks."lint:yaml"]
description = "YAML ファイルをチェック（prettier + yamllint）"
run = ["fd -e yml -e yaml -X prettier --check", "yamllint .github/"]

[tasks."lint:shell"]
description = "シェルスクリプトをチェック"
run = "fd -e sh -X shfmt -d"

[tasks."lint:links"]
description = "Markdown リンクチェック（時間がかかるため個別実行推奨）"
run = "fd -e md -x markdown-link-check --config .markdown-link-check.json"

[tasks."lint:links:verbose"]
description = "Markdown リンクチェック（詳細モード）"
run = "fd -e md -x markdown-link-check --config .markdown-link-check.json --verbose"

[tasks."lint:lua"]
description = "Lua ファイルをチェック"
depends = ["lint:lua:stylua", "lint:lua:luacheck"]

[tasks."lint:lua:stylua"]
description = "Stylua でコードスタイルをチェック"
run = "stylua --check ."

[tasks."lint:lua:luacheck"]
description = "luacheck を実行（利用可能な場合）"
run = "if command -v luacheck >/dev/null 2>&1; then luacheck .; fi"
