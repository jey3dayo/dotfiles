# ========================================
# ã‚°ãƒ­ãƒ¼ãƒãƒ« mise è¨­å®šï¼ˆãƒ„ãƒ¼ãƒ«ãƒ»å…±é€šè¨­å®šã®ã¿ï¼‰
# ~/.config/mise/config.toml
# ========================================

[settings]
env_file = '.env.local'
experimental = true
jobs = 8                                                            # ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®ä¸¦åˆ—å®Ÿè¡Œæ•°
vfox = false
idiomatic_version_file_enable_tools = ["go"]
trusted_config_paths = ["~/src/github.com", "/private/var/folders"]

[settings.pipx]
uvx = true

[env]
_.source = [".venv/bin/activate"]
YAMLLINT_CONFIG_FILE = "yamllint/config"
MD_GLOB = "**/*.md"
MD_EXCLUDES = "#node_modules #tmux/plugins #fisher #zsh/.zinit"

# ========================================
# ã‚ªãƒ—ã‚·ãƒ§ãƒ³ç’°å¢ƒå¤‰æ•°ï¼ˆãƒ•ã‚¡ã‚¤ãƒ«é™å®šå‡¦ç†ï¼‰
# ========================================
# ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ/lint ã‚¿ã‚¹ã‚¯ã§ç‰¹å®šãƒ•ã‚¡ã‚¤ãƒ«ã®ã¿å‡¦ç†ã™ã‚‹å ´åˆã«è¨­å®š
# ä¾‹: SH_FILES="script1.sh script2.sh" mise run format:shell
#
# SH_FILES = ""      # ã‚·ã‚§ãƒ«ã‚¹ã‚¯ãƒªãƒ—ãƒˆ
# PY_FILES = ""      # Python ãƒ•ã‚¡ã‚¤ãƒ«
# LUA_FILES = ""     # Lua ãƒ•ã‚¡ã‚¤ãƒ«
# TOML_FILES = ""    # TOML ãƒ•ã‚¡ã‚¤ãƒ«
# BIOME_FILES = ""   # JS/TS/JSON ãƒ•ã‚¡ã‚¤ãƒ« (biome)
# PRETTIER_FILES = "" # Prettier å¯¾è±¡ãƒ•ã‚¡ã‚¤ãƒ«
# YAML_FILES = ""    # YAML ãƒ•ã‚¡ã‚¤ãƒ«

[tools]
actionlint = "latest" # GitHub Actions workflow lint
biome = "latest"
fd = "latest"
go = "1.25.5"
node = "24"
python = "3.14"
"pipx:uv" = "latest"
# FIXME: Temporarily disabled due to CI failures - revisit when stable
# "pipx:git+https://github.com/agentskills/agentskills.git" = "main#subdirectory=skills-ref"
prettier = "latest"
stylua = "latest"
shfmt = "latest"
shellcheck = "latest"
# FIXME: Temporarily disabled due to luarocks 3.13.0 rockspec parsing issues in CI
# lua = "5.1.5"             # LuaRocks/Neovim require Lua 5.1
# luajit = "latest"
yamllint = "latest"                                        # YAML lint
"npm:@antfu/ni" = "latest"
"npm:@bufbuild/protoc-gen-es" = "latest"
"npm:@connectrpc/protoc-gen-connect-es" = "latest"
"npm:@fsouza/prettierd" = "latest"
"npm:@openai/codex" = "latest"
"npm:aicommits" = "latest"
"npm:corepack" = "latest"
"npm:husky" = "latest"
"npm:markdown-link-check" = "latest"
"npm:markdownlint-cli2" = "latest"
"npm:neovim" = "latest"
"npm:npm" = "latest"
"npm:npm-check-updates" = "latest"
"npm:textlint" = "latest"
"npm:textlint-rule-preset-ja-technical-writing" = "latest"
"npm:@dotenvx/dotenvx" = "latest"
taplo = "latest"

# ========================================
# Cargo-based tools (Rust CLI utilities)
# ========================================
# Usage: mise install to install all tools
# Syntax: "cargo:<crate-name>" = "version"
# Note: bat, ripgrep, fd, eza, hexyl, zoxide, typos-lsp are managed by Homebrew (see Brewfile)
"cargo:needle-cli" = "latest"    # Semantic code search
"cargo:similarity-ts" = "latest" # TypeScript/JavaScript code similarity analyzer
"cargo:wrkflw" = "latest"        # GitHub Actions workflow runner
"cargo:bandwhich" = "latest"     # Network bandwidth monitor
opencode = "latest"

[tasks."format:biome"]
description = "JS/TS/JSON ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆï¼ˆBIOME_FILES ã§å¯¾è±¡ã‚’é™å®šå¯èƒ½ï¼‰"
run = """
if [ -n "${BIOME_FILES:-}" ]; then
  biome format --write ${BIOME_FILES}
else
  biome format --write .
fi
"""

[tasks."format:biome:check"]
description = "JS/TS/JSON ãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆãƒã‚§ãƒƒã‚¯ï¼ˆæ›¸ãè¾¼ã¿ãªã—ã€BIOME_FILES ã§å¯¾è±¡ã‚’é™å®šå¯èƒ½ï¼‰"
run = """
if [ -n "${BIOME_FILES:-}" ]; then
  biome check --formatter-enabled=true --linter-enabled=false ${BIOME_FILES}
else
  biome check --formatter-enabled=true --linter-enabled=false .
fi
"""

[tasks."format:prettier"]
description = "Prettier ã§ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆï¼ˆPRETTIER_FILES ã§å¯¾è±¡ã‚’é™å®šå¯èƒ½ï¼‰"
run = """
if [ -n "${PRETTIER_FILES:-}" ]; then
  prettier --write --ignore-unknown ${PRETTIER_FILES}
else
  prettier --write --ignore-unknown .
fi
"""

[tasks."format:prettier:check"]
description = "Prettier ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆãƒã‚§ãƒƒã‚¯ï¼ˆæ›¸ãè¾¼ã¿ãªã—ã€PRETTIER_FILES ã§å¯¾è±¡ã‚’é™å®šå¯èƒ½ï¼‰"
run = """
if [ -n "${PRETTIER_FILES:-}" ]; then
  prettier --check --ignore-unknown ${PRETTIER_FILES}
else
  prettier --check --ignore-unknown .
fi
"""

[tasks."format:markdown"]
description = "Markdown ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ"
run = [
  "markdownlint-cli2 --fix \"${MD_GLOB}\" ${MD_EXCLUDES}",
  "fd -e md -X prettier --write",
]

[tasks."format:markdown:check"]
description = "Markdown ãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆãƒã‚§ãƒƒã‚¯ï¼ˆæ›¸ãè¾¼ã¿ãªã—ï¼‰"
run = "fd -e md -X prettier --check"

[tasks."format:yaml"]
description = "YAML ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆï¼ˆYAML_FILES ã§å¯¾è±¡ã‚’é™å®šå¯èƒ½ï¼‰"
run = """
if [ -n "${YAML_FILES:-}" ]; then
  prettier --write ${YAML_FILES}
else
  fd -e yml -e yaml -X prettier --write
fi
"""

[tasks."format:yaml:check"]
description = "YAML ãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆãƒã‚§ãƒƒã‚¯ï¼ˆæ›¸ãè¾¼ã¿ãªã—ã€YAML_FILES ã§å¯¾è±¡ã‚’é™å®šå¯èƒ½ï¼‰"
run = """
if [ -n "${YAML_FILES:-}" ]; then
  prettier --check ${YAML_FILES}
else
  fd -e yml -e yaml -X prettier --check
fi
"""

[tasks."format:lua"]
description = "Lua ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆï¼ˆLUA_FILES ã§å¯¾è±¡ã‚’é™å®šå¯èƒ½ï¼‰"
run = """
if [ -n "${LUA_FILES:-}" ]; then
  stylua ${LUA_FILES}
else
  stylua .
fi
"""

[tasks."format:lua:check"]
description = "Lua ãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆãƒã‚§ãƒƒã‚¯ï¼ˆæ›¸ãè¾¼ã¿ãªã—ã€LUA_FILES ã§å¯¾è±¡ã‚’é™å®šå¯èƒ½ï¼‰"
run = """
if [ -n "${LUA_FILES:-}" ]; then
  stylua --check ${LUA_FILES}
else
  stylua --check .
fi
"""

[tasks."format:shell"]
description = "ã‚·ã‚§ãƒ«ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆï¼ˆSH_FILES ã§å¯¾è±¡ã‚’é™å®šå¯èƒ½ï¼‰"
run = """
if [ -n "${SH_FILES:-}" ]; then
  shfmt -w -i 2 -ci -bn ${SH_FILES}
else
  fd -e sh -X shfmt -w -i 2 -ci -bn
fi
"""

[tasks."format:shell:check"]
description = "ã‚·ã‚§ãƒ«ã‚¹ã‚¯ãƒªãƒ—ãƒˆã®ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆãƒã‚§ãƒƒã‚¯ï¼ˆæ›¸ãè¾¼ã¿ãªã—ã€SH_FILES ã§å¯¾è±¡ã‚’é™å®šå¯èƒ½ï¼‰"
run = """
if [ -n "${SH_FILES:-}" ]; then
  shfmt -d -i 2 -ci -bn ${SH_FILES}
else
  fd -e sh -X shfmt -d -i 2 -ci -bn
fi
"""

[tasks."format:toml"]
description = "TOML ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆï¼ˆTOML_FILES ã§å¯¾è±¡ã‚’é™å®šå¯èƒ½ï¼‰"
run = """
if [ -n "${TOML_FILES:-}" ]; then
  taplo format ${TOML_FILES}
else
  taplo format .
fi
"""

[tasks."format:toml:check"]
description = "TOML ãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆãƒã‚§ãƒƒã‚¯ï¼ˆæ›¸ãè¾¼ã¿ãªã—ã€TOML_FILES ã§å¯¾è±¡ã‚’é™å®šå¯èƒ½ï¼‰"
run = """
if [ -n "${TOML_FILES:-}" ]; then
  taplo format --check ${TOML_FILES}
else
  taplo format --check .
fi
"""

[tasks."format:python"]
description = "Python ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆï¼ˆPY_FILES ã§å¯¾è±¡ã‚’é™å®šå¯èƒ½ï¼‰"
run = """
if [ -n "${PY_FILES:-}" ]; then
  uvx ruff format ${PY_FILES}
else
  uvx ruff format .
fi
"""

[tasks."format:python:check"]
description = "Python ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆãƒã‚§ãƒƒã‚¯ï¼ˆæ›¸ãè¾¼ã¿ãªã—ã€PY_FILES ã§å¯¾è±¡ã‚’é™å®šå¯èƒ½ï¼‰"
run = """
if [ -n "${PY_FILES:-}" ]; then
  uvx ruff format --check ${PY_FILES}
else
  uvx ruff format --check .
fi
"""

[tasks."format:docs"]
description = "ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã®å®Œå…¨ãªæ¤œè¨¼ã¨ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ"
depends = ["format:markdown", "lint:links", "lint:yaml"]

[tasks."lint:docs"]
description = "ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆç³»ãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆMD/YAML/JSON/Linksï¼‰ã®çµ±åˆLint"
depends = ["lint:markdown", "lint:yaml", "lint:biome", "lint:links"]

[tasks."lint:biome"]
description = "JS/TS/JSON ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒã‚§ãƒƒã‚¯ï¼ˆBIOME_FILES ã§å¯¾è±¡ã‚’é™å®šå¯èƒ½ï¼‰"
run = """
if [ -n "${BIOME_FILES:-}" ]; then
  biome check ${BIOME_FILES}
else
  biome check .
fi
"""

[tasks."lint:markdown"]
description = "Markdown ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒã‚§ãƒƒã‚¯"
run = [
  "markdownlint-cli2 \"${MD_GLOB}\" ${MD_EXCLUDES}",
  "fd -e md -X prettier --check",
]

[tasks."lint:toml"]
description = "TOML ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒã‚§ãƒƒã‚¯ï¼ˆTOML_FILES ã§å¯¾è±¡ã‚’é™å®šå¯èƒ½ï¼‰"
run = """
if [ -n "${TOML_FILES:-}" ]; then
  taplo format --check ${TOML_FILES}
else
  taplo format --check .
fi
"""

[tasks."lint:yaml"]
description = "YAML ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒã‚§ãƒƒã‚¯ï¼ˆprettier + yamllintã€YAML_FILES ã§å¯¾è±¡ã‚’é™å®šå¯èƒ½ï¼‰"
run = """
if [ -n "${YAML_FILES:-}" ]; then
  prettier --check ${YAML_FILES}
  # yamllint ã¯ YAML_FILES æŒ‡å®šæ™‚ã‚‚ .github/ ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’ãƒã‚§ãƒƒã‚¯
  yamllint -f parsable .github/
else
  fd -e yml -e yaml -X prettier --check
  yamllint -f parsable .github/
fi
"""

[tasks."lint:python"]
description = "Python ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒã‚§ãƒƒã‚¯ï¼ˆPY_FILES ã§å¯¾è±¡ã‚’é™å®šå¯èƒ½ï¼‰"
run = """
if [ -n "${PY_FILES:-}" ]; then
  uvx ruff check ${PY_FILES}
else
  uvx ruff check .
fi
"""

[tasks."lint:shell"]
description = "ã‚·ã‚§ãƒ«ã‚¹ã‚¯ãƒªãƒ—ãƒˆ (.sh/.zsh) ã‚’ãƒã‚§ãƒƒã‚¯ï¼ˆSH_FILES ã§å¯¾è±¡ã‚’é™å®šå¯èƒ½ï¼‰"
run = """
if [ -n "${SH_FILES:-}" ]; then
  shfmt -d -i 2 -ci -bn ${SH_FILES}
  shellcheck ${SH_FILES}
else
  fd -e sh -X shfmt -d -i 2 -ci -bn
  fd -e sh -X shellcheck
  fd --hidden -e zsh -X zsh -n
fi
"""

[tasks."lint:dockerfile"]
description = "Dockerfile ã‚’ãƒã‚§ãƒƒã‚¯ï¼ˆhadolintã€--no-color ã‚ªãƒ—ã‚·ãƒ§ãƒ³ä»˜ãï¼‰"
run = """
if [ -n "${DOCKERFILE_FILES:-}" ]; then
  hadolint --no-color ${DOCKERFILE_FILES}
else
  fd -t f -e dockerfile -X hadolint --no-color
  fd -t f --glob 'Dockerfile*' -X hadolint --no-color
fi
"""

[tasks."lint:links"]
description = "Markdown ãƒªãƒ³ã‚¯ãƒã‚§ãƒƒã‚¯ï¼ˆæ™‚é–“ãŒã‹ã‹ã‚‹ãŸã‚å€‹åˆ¥å®Ÿè¡Œæ¨å¥¨ï¼‰"
run = "fd -e md -x markdown-link-check --config .markdown-link-check.json -q"

[tasks."lint:links:verbose"]
description = "Markdown ãƒªãƒ³ã‚¯ãƒã‚§ãƒƒã‚¯ï¼ˆè©³ç´°ãƒ¢ãƒ¼ãƒ‰ï¼‰"
run = "fd -e md -x markdown-link-check --config .markdown-link-check.json --verbose"

[tasks."lint:lua"]
description = "Lua ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒã‚§ãƒƒã‚¯"
depends = ["lint:lua:stylua", "lint:lua:luacheck"]

[tasks."lint:lua:stylua"]
description = "Stylua ã§ã‚³ãƒ¼ãƒ‰ã‚¹ã‚¿ã‚¤ãƒ«ã‚’ãƒã‚§ãƒƒã‚¯ï¼ˆLUA_FILES ã§å¯¾è±¡ã‚’é™å®šå¯èƒ½ï¼‰"
run = """
if [ -n "${LUA_FILES:-}" ]; then
  stylua --check ${LUA_FILES}
else
  stylua --check .
fi
"""

[tasks."lint:lua:luacheck"]
description = "luacheck ã‚’å®Ÿè¡Œï¼ˆåˆ©ç”¨å¯èƒ½ãªå ´åˆï¼‰"
run = "if command -v luacheck >/dev/null 2>&1; then luacheck -q .; fi"

# ========================================
# çµ±åˆã‚¿ã‚¹ã‚¯ï¼ˆã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ãƒ»è¨ºæ–­ãƒ»ä¸€æ‹¬å®Ÿè¡Œï¼‰
# ========================================

[tasks.setup]
description = "åˆå›ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—: ãƒ„ãƒ¼ãƒ«ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã€ä¾å­˜é–¢ä¿‚ã®ç¢ºèª"
run = """
echo "ğŸ“¦ Installing mise tools..."
mise install

echo ""
echo "ğŸ Installing Python packages for Neovim..."
PYTHON_PATH=$(mise where python)/bin/python3
$PYTHON_PATH -m pip install --quiet pynvim

echo ""
echo "ğŸ” Verifying critical tools..."
command -v biome >/dev/null || echo "âš ï¸  biome not found"
command -v prettier >/dev/null || echo "âš ï¸  prettier not found"
command -v stylua >/dev/null || echo "âš ï¸  stylua not found"
command -v shfmt >/dev/null || echo "âš ï¸  shfmt not found"
command -v shellcheck >/dev/null || echo "âš ï¸  shellcheck not found"
command -v taplo >/dev/null || echo "âš ï¸  taplo not found"
command -v yamllint >/dev/null || echo "âš ï¸  yamllint not found"
command -v markdownlint-cli2 >/dev/null || echo "âš ï¸  markdownlint-cli2 not found"
command -v uvx >/dev/null || echo "âš ï¸  uv not found"
$PYTHON_PATH -c "import pynvim; print('âœ“ pynvim:', pynvim.__version__)" || echo "âš ï¸  pynvim not found"

echo ""
echo "âœ… Setup complete. Run 'mise tasks' to see available tasks."
"""

[tasks.doctor]
description = "ç’°å¢ƒè¨ºæ–­: ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ¸ˆã¿ãƒ„ãƒ¼ãƒ«ã¨è¨­å®šã‚’ç¢ºèª"
run = """
echo "=== Mise Configuration ==="
mise doctor

echo ""
echo "=== Installed Tools ==="
mise ls

echo ""
echo "=== Available Tasks ==="
mise tasks | head -20
echo "... (run 'mise tasks' to see all)"
"""

[tasks.format]
description = "å…¨ãƒ•ã‚¡ã‚¤ãƒ«ã‚¿ã‚¤ãƒ—ã®ä¸€æ‹¬ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆï¼ˆè‡ªå‹•ä¿®æ­£ï¼‰"
depends = [
  "format:biome",
  "format:prettier",
  "format:markdown",
  "format:yaml",
  "format:lua",
  "format:shell",
  "format:toml",
  "format:python",
]

[tasks.lint]
description = "å…¨ãƒ•ã‚¡ã‚¤ãƒ«ã‚¿ã‚¤ãƒ—ã®ä¸€æ‹¬Lintï¼ˆãƒã‚§ãƒƒã‚¯ã®ã¿ï¼‰"
depends = [
  "lint:biome",
  "lint:markdown",
  "lint:yaml",
  "lint:lua",
  "lint:shell",
  "lint:toml",
  "lint:python",
]

[tasks.check]
description = "format + lint ã®å®Œå…¨ãƒã‚§ãƒƒã‚¯ï¼ˆæ›¸ãè¾¼ã¿ãªã—ã€CI/pre-commitç”¨ï¼‰"
depends = [
  "format:biome:check",
  "format:prettier:check",
  "format:markdown:check",
  "format:yaml:check",
  "format:lua:check",
  "format:shell:check",
  "format:toml:check",
  "format:python:check",
  "lint",
]
