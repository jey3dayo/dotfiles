# ========================================
# ã‚°ãƒ­ãƒ¼ãƒãƒ« mise è¨­å®šï¼ˆãƒ„ãƒ¼ãƒ«ãƒ»å…±é€šè¨­å®šã®ã¿ï¼‰
# ~/.config/mise/config.toml
# ========================================

[settings]
env_file = '.env.local'
experimental = true
jobs = 8                                                            # ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®ä¸¦åˆ—å®Ÿè¡Œæ•°
vfox = false
idiomatic_version_file_enable_tools = ["go"]
trusted_config_paths = ["~/src/github.com", "/private/var/folders"]

[settings.pipx]
uvx = true

[env]
_.source = [".venv/bin/activate"]
YAMLLINT_CONFIG_FILE = "yamllint/config"
MD_GLOB = "**/*.md"
MD_EXCLUDES = "#node_modules #tmux/plugins #fisher #zsh/.zinit"

# ========================================
# ã‚ªãƒ—ã‚·ãƒ§ãƒ³ç’°å¢ƒå¤‰æ•°ï¼ˆãƒ•ã‚¡ã‚¤ãƒ«é™å®šå‡¦ç†ï¼‰
# ========================================
# ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ/lint ã‚¿ã‚¹ã‚¯ã§ç‰¹å®šãƒ•ã‚¡ã‚¤ãƒ«ã®ã¿å‡¦ç†ã™ã‚‹å ´åˆã«è¨­å®š
# ä¾‹: SH_FILES="script1.sh script2.sh" mise run format:shell
#
# SH_FILES = ""      # ã‚·ã‚§ãƒ«ã‚¹ã‚¯ãƒªãƒ—ãƒˆ
# PY_FILES = ""      # Python ãƒ•ã‚¡ã‚¤ãƒ«
# LUA_FILES = ""     # Lua ãƒ•ã‚¡ã‚¤ãƒ«
# TOML_FILES = ""    # TOML ãƒ•ã‚¡ã‚¤ãƒ«
# BIOME_FILES = ""   # JS/TS/JSON ãƒ•ã‚¡ã‚¤ãƒ« (biome)
# PRETTIER_FILES = "" # Prettier å¯¾è±¡ãƒ•ã‚¡ã‚¤ãƒ«
# YAML_FILES = ""    # YAML ãƒ•ã‚¡ã‚¤ãƒ«

# ========================================
# ãƒ„ãƒ¼ãƒ«å®šç¾© (Tools)
# ========================================
# mise ã§ç®¡ç†ã™ã‚‹å…¨ãƒ„ãƒ¼ãƒ«ã‚’å®šç¾©
# ã‚«ãƒ†ã‚´ãƒª: 1) Runtimes, 2) Package Managers, 3) Formatters/Linters,
#          4) NPM Packages, 5) Cargo Tools, 6) CLI Tools

[tools]
# ========================================
# 1. Language Runtimes (è¨€èªãƒ©ãƒ³ã‚¿ã‚¤ãƒ  - é–‹ç™ºç”¨)
# ========================================
# æ³¨: ã‚·ã‚¹ãƒ†ãƒ ä¾å­˜é–¢ä¿‚ç”¨ã® Node.js/Python ã¯ Homebrew ã§ç®¡ç†
go = "1.25.5"                    # Go ãƒ©ãƒ³ã‚¿ã‚¤ãƒ 
node = "24"                      # Node.js ãƒ©ãƒ³ã‚¿ã‚¤ãƒ  (é–‹ç™ºç”¨)
python = "3.14"                  # Python ãƒ©ãƒ³ã‚¿ã‚¤ãƒ  (é–‹ç™ºç”¨)
# FIXME: Temporarily disabled due to luarocks 3.13.0 rockspec parsing issues in CI
# lua = "5.1.5"                  # LuaRocks/Neovim äº’æ›ç‰ˆ (Homebrew ã§ç®¡ç†æ¨å¥¨)
# luajit = "latest"              # LuaJIT (Homebrew ã§ç®¡ç†æ¨å¥¨)

# ========================================
# 2. Package Managers (ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼)
# ========================================
"pipx:uv" = "latest"             # Python: é«˜é€Ÿãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼
bun = "latest"                   # JavaScript ãƒ©ãƒ³ã‚¿ã‚¤ãƒ  + ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼

# FIXME: Temporarily disabled due to CI failures - revisit when stable
# "pipx:git+https://github.com/agentskills/agentskills.git" = "main#subdirectory=skills-ref"

# ========================================
# 3. Formatters and Linters (ãƒ•ã‚©ãƒ¼ãƒãƒƒã‚¿ãƒ¼ãƒ»Linter - çµ±ä¸€ç®¡ç†)
# ========================================
actionlint = "latest"            # GitHub Actions ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ Linter
biome = "latest"                 # JavaScript/TypeScript/JSON ãƒ•ã‚©ãƒ¼ãƒãƒƒã‚¿ãƒ¼ + Linter
hadolint = "latest"              # Dockerfile Linter
prettier = "latest"              # ãƒãƒ«ãƒè¨€èªå¯¾å¿œãƒ•ã‚©ãƒ¼ãƒãƒƒã‚¿ãƒ¼
shellcheck = "latest"            # Shell ã‚¹ã‚¯ãƒªãƒ—ãƒˆ Linter
shfmt = "latest"                 # Shell ã‚¹ã‚¯ãƒªãƒ—ãƒˆ ãƒ•ã‚©ãƒ¼ãƒãƒƒã‚¿ãƒ¼
stylua = "latest"                # Lua ãƒ•ã‚©ãƒ¼ãƒãƒƒã‚¿ãƒ¼
taplo = "latest"                 # TOML ãƒ•ã‚©ãƒ¼ãƒãƒƒã‚¿ãƒ¼ + Linter
yamllint = "latest"              # YAML Linter

# ========================================
# 4. NPM Global Packages (Node.js ã‚°ãƒ­ãƒ¼ãƒãƒ«ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸)
# ========================================

# ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ãƒ»ãƒ„ãƒ¼ãƒ«
"npm:@antfu/ni" = "latest"       # çµ±ä¸€ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹
"npm:corepack" = "latest"        # è¤‡æ•°ã®ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼ç®¡ç†
"npm:husky" = "latest"           # Git hooks ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯
"npm:npm" = "latest"             # npm æœ¬ä½“
"npm:npm-check-updates" = "latest"  # npm ä¾å­˜é–¢ä¿‚ã®æ›´æ–°ãƒã‚§ãƒƒã‚¯

# é–‹ç™ºãƒ»ã‚¨ãƒ‡ã‚£ã‚¿
"npm:@fsouza/prettierd" = "latest"  # Prettier ãƒ‡ãƒ¼ãƒ¢ãƒ³ (ã‚¨ãƒ‡ã‚£ã‚¿çµ±åˆ)
"npm:neovim" = "latest"          # Neovim Node.js ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ

# ãƒ—ãƒ­ãƒˆã‚³ãƒ«ãƒãƒƒãƒ•ã‚¡ãƒ»RPC
"npm:@bufbuild/protoc-gen-es" = "latest"  # Protobuf: ECMAScript ã‚³ãƒ¼ãƒ‰ç”Ÿæˆ
"npm:@connectrpc/protoc-gen-connect-es" = "latest"  # Connect: ECMAScript RPC ã‚³ãƒ¼ãƒ‰ç”Ÿæˆ

# AIãƒ»ã‚³ãƒŸãƒƒãƒˆæ”¯æ´
"npm:@openai/codex" = "latest"   # OpenAI Codex SDK
"npm:aicommits" = "latest"       # AI ã«ã‚ˆã‚‹è‡ªå‹•ã‚³ãƒŸãƒƒãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ç”Ÿæˆ

# ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆãƒ»Lint
"npm:markdown-link-check" = "latest"  # Markdown ãƒªãƒ³ã‚¯æ¤œè¨¼
"npm:markdownlint-cli2" = "latest"    # Markdown Linter
"npm:textlint" = "latest"        # æ—¥æœ¬èªãƒ†ã‚­ã‚¹ãƒˆ Linter
"npm:textlint-rule-preset-ja-technical-writing" = "latest"  # æ—¥æœ¬èªæŠ€è¡“æ–‡ç« ãƒ«ãƒ¼ãƒ«

# ç’°å¢ƒå¤‰æ•°ç®¡ç†
"npm:@dotenvx/dotenvx" = "latest"  # .env ãƒ•ã‚¡ã‚¤ãƒ«ç®¡ç†ãƒ»æš—å·åŒ–

# é–‹ç™ºãƒ„ãƒ¼ãƒ«ãƒ»Language Servers
"npm:eslint_d" = "latest"         # ESLint ãƒ‡ãƒ¼ãƒ¢ãƒ³ (ã‚¨ãƒ‡ã‚£ã‚¿çµ±åˆ)
"npm:typescript" = "latest"       # TypeScript ã‚³ãƒ³ãƒ‘ã‚¤ãƒ©
"npm:typescript-language-server" = "latest"  # TypeScript LSP
"npm:vscode-json-languageserver" = "latest"  # JSON LSP
"npm:vscode-langservers-extracted" = "latest"  # HTML/CSS/JSON/ESLint LSP
"npm:@typescript-eslint/eslint-plugin" = "latest"  # TypeScript ESLint ãƒ—ãƒ©ã‚°ã‚¤ãƒ³

# ãƒ“ãƒ«ãƒ‰ãƒ„ãƒ¼ãƒ«
"npm:esbuild" = "latest"          # é«˜é€Ÿ JavaScript/TypeScript ãƒãƒ³ãƒ‰ãƒ©ãƒ¼

# ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£
"npm:zx" = "latest"               # JavaScript ã‚·ã‚§ãƒ«ã‚¹ã‚¯ãƒªãƒ—ãƒˆ

# MCP ã‚µãƒ¼ãƒãƒ¼ (Model Context Protocol)
"npm:@aikidosec/safe-chain" = "latest"  # MCP: ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒã‚§ãƒ¼ãƒ³
"npm:@benborla29/mcp-server-mysql" = "latest"  # MCP: MySQL ã‚µãƒ¼ãƒãƒ¼
"npm:@modelcontextprotocol/server-filesystem" = "latest"  # MCP: ãƒ•ã‚¡ã‚¤ãƒ«ã‚·ã‚¹ãƒ†ãƒ 
"npm:@playwright/mcp" = "latest"  # MCP: Playwright çµ±åˆ
"npm:@upstash/context7-mcp" = "latest"  # MCP: Context7 çµ±åˆ
"npm:chrome-devtools-mcp" = "latest"  # MCP: Chrome DevTools
"npm:exa-mcp-server" = "latest"   # MCP: Exa ã‚µãƒ¼ãƒãƒ¼
"npm:o3-search-mcp" = "latest"    # MCP: O3 æ¤œç´¢

# Claude/AI ãƒ„ãƒ¼ãƒ«
"npm:@anthropic-ai/dxt" = "latest"  # Anthropic DXT ãƒ„ãƒ¼ãƒ«
"npm:@mariozechner/claude-bridge" = "latest"  # Claude ãƒ–ãƒªãƒƒã‚¸
"npm:@sasazame/ccresume" = "latest"  # Claude Code Resume
"npm:ccusage" = "latest"          # Claude Code ä½¿ç”¨çŠ¶æ³ãƒˆãƒ©ãƒƒã‚«ãƒ¼
"npm:dev3000" = "latest"          # é–‹ç™ºã‚µãƒ¼ãƒãƒ¼

# ã‚¯ãƒ©ã‚¦ãƒ‰ãƒ»ã‚¤ãƒ³ãƒ•ãƒ©
"npm:aws-cdk" = "latest"          # AWS CDK
"npm:@google/clasp" = "latest"    # Google Apps Script CLI
"npm:@google/gemini-cli" = "latest"  # Google Gemini CLI

# ãã®ä»–ãƒ„ãƒ¼ãƒ«
"npm:greptile" = "latest"         # ã‚³ãƒ¼ãƒ‰æ¤œç´¢ãƒ„ãƒ¼ãƒ«
"npm:difit" = "latest"            # ãƒ‡ã‚£ãƒ•ã‚£ãƒƒãƒˆãƒ„ãƒ¼ãƒ«
"npm:tuyapi" = "latest"           # Tuya API ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ

# ========================================
# 5. Cargo-based Tools (Rust CLI ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£)
# ========================================
# æ³¨: bat, ripgrep, eza, hexyl, zoxide, typos-lsp ã¯ Homebrew ã§ç®¡ç† (Brewfile å‚ç…§)
"cargo:bandwhich" = "latest"     # ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯å¸¯åŸŸå¹…ãƒ¢ãƒ‹ã‚¿ãƒªãƒ³ã‚°
"cargo:needle-cli" = "latest"    # ã‚»ãƒãƒ³ãƒ†ã‚£ãƒƒã‚¯ã‚³ãƒ¼ãƒ‰æ¤œç´¢
"cargo:similarity-ts" = "latest" # TypeScript/JavaScript ã‚³ãƒ¼ãƒ‰é¡ä¼¼åº¦åˆ†æ
"cargo:wrkflw" = "latest"        # GitHub Actions ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼å®Ÿè¡Œ

# ========================================
# 6. CLI Tools (ã‚³ãƒãƒ³ãƒ‰ãƒ©ã‚¤ãƒ³ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£)
# ========================================
aws-cli = "latest"               # AWS ã‚³ãƒãƒ³ãƒ‰ãƒ©ã‚¤ãƒ³ãƒ„ãƒ¼ãƒ«
eza = "latest"                   # ls ã® Rust å®Ÿè£… (ãƒ¢ãƒ€ãƒ³å‡ºåŠ›)
fd = "latest"                    # find ã®é«˜é€Ÿ Rust å®Ÿè£…
"github:cli/cli" = "latest"      # GitHub CLI
jq = "latest"                    # JSON ã‚¯ã‚¨ãƒªãƒ»ãƒ‘ãƒ¼ã‚µãƒ¼
opencode = "latest"              # ã‚³ãƒ¼ãƒ‰æ¤œç´¢ãƒ»ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³
yazi = "latest"                  # ã‚¿ãƒ¼ãƒŸãƒŠãƒ« ãƒ•ã‚¡ã‚¤ãƒ«ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼

[tasks."format:biome"]
description = "JS/TS/JSON ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆï¼ˆBIOME_FILES ã§å¯¾è±¡ã‚’é™å®šå¯èƒ½ï¼‰"
run = """
if [ -n "${BIOME_FILES:-}" ]; then
  biome format --write ${BIOME_FILES}
else
  biome format --write .
fi
"""

[tasks."format:biome:check"]
description = "JS/TS/JSON ãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆãƒã‚§ãƒƒã‚¯ï¼ˆæ›¸ãè¾¼ã¿ãªã—ã€BIOME_FILES ã§å¯¾è±¡ã‚’é™å®šå¯èƒ½ï¼‰"
run = """
if [ -n "${BIOME_FILES:-}" ]; then
  biome check --formatter-enabled=true --linter-enabled=false ${BIOME_FILES}
else
  biome check --formatter-enabled=true --linter-enabled=false .
fi
"""

[tasks."format:prettier"]
description = "Prettier ã§ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆï¼ˆPRETTIER_FILES ã§å¯¾è±¡ã‚’é™å®šå¯èƒ½ï¼‰"
run = """
if [ -n "${PRETTIER_FILES:-}" ]; then
  prettier --write --ignore-unknown ${PRETTIER_FILES}
else
  prettier --write --ignore-unknown .
fi
"""

[tasks."format:prettier:check"]
description = "Prettier ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆãƒã‚§ãƒƒã‚¯ï¼ˆæ›¸ãè¾¼ã¿ãªã—ã€PRETTIER_FILES ã§å¯¾è±¡ã‚’é™å®šå¯èƒ½ï¼‰"
run = """
if [ -n "${PRETTIER_FILES:-}" ]; then
  prettier --check --ignore-unknown ${PRETTIER_FILES}
else
  prettier --check --ignore-unknown .
fi
"""

[tasks."format:markdown"]
description = "Markdown ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ"
run = [
  "markdownlint-cli2 --fix \"${MD_GLOB}\" ${MD_EXCLUDES}",
  "fd -e md -X prettier --write",
]

[tasks."format:markdown:check"]
description = "Markdown ãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆãƒã‚§ãƒƒã‚¯ï¼ˆæ›¸ãè¾¼ã¿ãªã—ï¼‰"
run = "fd -e md -X prettier --check"

[tasks."format:yaml"]
description = "YAML ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆï¼ˆYAML_FILES ã§å¯¾è±¡ã‚’é™å®šå¯èƒ½ï¼‰"
run = """
if [ -n "${YAML_FILES:-}" ]; then
  prettier --write ${YAML_FILES}
else
  fd -e yml -e yaml -X prettier --write
fi
"""

[tasks."format:yaml:check"]
description = "YAML ãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆãƒã‚§ãƒƒã‚¯ï¼ˆæ›¸ãè¾¼ã¿ãªã—ã€YAML_FILES ã§å¯¾è±¡ã‚’é™å®šå¯èƒ½ï¼‰"
run = """
if [ -n "${YAML_FILES:-}" ]; then
  prettier --check ${YAML_FILES}
else
  fd -e yml -e yaml -X prettier --check
fi
"""

[tasks."format:lua"]
description = "Lua ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆï¼ˆLUA_FILES ã§å¯¾è±¡ã‚’é™å®šå¯èƒ½ï¼‰"
run = """
if [ -n "${LUA_FILES:-}" ]; then
  stylua ${LUA_FILES}
else
  stylua .
fi
"""

[tasks."format:lua:check"]
description = "Lua ãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆãƒã‚§ãƒƒã‚¯ï¼ˆæ›¸ãè¾¼ã¿ãªã—ã€LUA_FILES ã§å¯¾è±¡ã‚’é™å®šå¯èƒ½ï¼‰"
run = """
if [ -n "${LUA_FILES:-}" ]; then
  stylua --check ${LUA_FILES}
else
  stylua --check .
fi
"""

[tasks."format:shell"]
description = "ã‚·ã‚§ãƒ«ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆï¼ˆSH_FILES ã§å¯¾è±¡ã‚’é™å®šå¯èƒ½ï¼‰"
run = """
if [ -n "${SH_FILES:-}" ]; then
  shfmt -w -i 2 -ci -bn ${SH_FILES}
else
  fd -e sh -X shfmt -w -i 2 -ci -bn
fi
"""

[tasks."format:shell:check"]
description = "ã‚·ã‚§ãƒ«ã‚¹ã‚¯ãƒªãƒ—ãƒˆã®ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆãƒã‚§ãƒƒã‚¯ï¼ˆæ›¸ãè¾¼ã¿ãªã—ã€SH_FILES ã§å¯¾è±¡ã‚’é™å®šå¯èƒ½ï¼‰"
run = """
if [ -n "${SH_FILES:-}" ]; then
  shfmt -d -i 2 -ci -bn ${SH_FILES}
else
  fd -e sh -X shfmt -d -i 2 -ci -bn
fi
"""

[tasks."format:toml"]
description = "TOML ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆï¼ˆTOML_FILES ã§å¯¾è±¡ã‚’é™å®šå¯èƒ½ï¼‰"
run = """
if [ -n "${TOML_FILES:-}" ]; then
  taplo format ${TOML_FILES}
else
  taplo format .
fi
"""

[tasks."format:toml:check"]
description = "TOML ãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆãƒã‚§ãƒƒã‚¯ï¼ˆæ›¸ãè¾¼ã¿ãªã—ã€TOML_FILES ã§å¯¾è±¡ã‚’é™å®šå¯èƒ½ï¼‰"
run = """
if [ -n "${TOML_FILES:-}" ]; then
  taplo format --check ${TOML_FILES}
else
  taplo format --check .
fi
"""

[tasks."format:python"]
description = "Python ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆï¼ˆPY_FILES ã§å¯¾è±¡ã‚’é™å®šå¯èƒ½ï¼‰"
run = """
if [ -n "${PY_FILES:-}" ]; then
  uvx ruff format ${PY_FILES}
else
  uvx ruff format .
fi
"""

[tasks."format:python:check"]
description = "Python ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆãƒã‚§ãƒƒã‚¯ï¼ˆæ›¸ãè¾¼ã¿ãªã—ã€PY_FILES ã§å¯¾è±¡ã‚’é™å®šå¯èƒ½ï¼‰"
run = """
if [ -n "${PY_FILES:-}" ]; then
  uvx ruff format --check ${PY_FILES}
else
  uvx ruff format --check .
fi
"""

[tasks."format:docs"]
description = "ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã®å®Œå…¨ãªæ¤œè¨¼ã¨ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ"
depends = ["format:markdown", "lint:links", "lint:yaml"]

[tasks."lint:docs"]
description = "ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆç³»ãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆMD/YAML/JSON/Linksï¼‰ã®çµ±åˆLint"
depends = ["lint:markdown", "lint:yaml", "lint:biome", "lint:links"]

[tasks."lint:biome"]
description = "JS/TS/JSON ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒã‚§ãƒƒã‚¯ï¼ˆBIOME_FILES ã§å¯¾è±¡ã‚’é™å®šå¯èƒ½ï¼‰"
run = """
if [ -n "${BIOME_FILES:-}" ]; then
  biome check ${BIOME_FILES}
else
  biome check .
fi
"""

[tasks."lint:markdown"]
description = "Markdown ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒã‚§ãƒƒã‚¯"
run = [
  "markdownlint-cli2 \"${MD_GLOB}\" ${MD_EXCLUDES}",
  "fd -e md -X prettier --check",
]

[tasks."lint:toml"]
description = "TOML ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒã‚§ãƒƒã‚¯ï¼ˆTOML_FILES ã§å¯¾è±¡ã‚’é™å®šå¯èƒ½ï¼‰"
run = """
if [ -n "${TOML_FILES:-}" ]; then
  taplo format --check ${TOML_FILES}
else
  taplo format --check .
fi
"""

[tasks."lint:yaml"]
description = "YAML ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒã‚§ãƒƒã‚¯ï¼ˆprettier + yamllintã€YAML_FILES ã§å¯¾è±¡ã‚’é™å®šå¯èƒ½ï¼‰"
run = """
if [ -n "${YAML_FILES:-}" ]; then
  prettier --check ${YAML_FILES}
  # yamllint ã¯ YAML_FILES æŒ‡å®šæ™‚ã‚‚ .github/ ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’ãƒã‚§ãƒƒã‚¯
  yamllint -f parsable .github/
else
  fd -e yml -e yaml -X prettier --check
  yamllint -f parsable .github/
fi
"""

[tasks."lint:python"]
description = "Python ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒã‚§ãƒƒã‚¯ï¼ˆPY_FILES ã§å¯¾è±¡ã‚’é™å®šå¯èƒ½ï¼‰"
run = """
if [ -n "${PY_FILES:-}" ]; then
  uvx ruff check ${PY_FILES}
else
  uvx ruff check .
fi
"""

[tasks."lint:shell"]
description = "ã‚·ã‚§ãƒ«ã‚¹ã‚¯ãƒªãƒ—ãƒˆ (.sh/.zsh) ã‚’ãƒã‚§ãƒƒã‚¯ï¼ˆSH_FILES ã§å¯¾è±¡ã‚’é™å®šå¯èƒ½ï¼‰"
run = """
if [ -n "${SH_FILES:-}" ]; then
  shfmt -d -i 2 -ci -bn ${SH_FILES}
  shellcheck ${SH_FILES}
else
  fd -e sh -X shfmt -d -i 2 -ci -bn
  fd -e sh -X shellcheck
  fd --hidden -e zsh -X zsh -n
fi
"""

[tasks."lint:dockerfile"]
description = "Dockerfile ã‚’ãƒã‚§ãƒƒã‚¯ï¼ˆhadolintã€--no-color ã‚ªãƒ—ã‚·ãƒ§ãƒ³ä»˜ãï¼‰"
run = """
if [ -n "${DOCKERFILE_FILES:-}" ]; then
  hadolint --no-color ${DOCKERFILE_FILES}
else
  fd -t f -e dockerfile -X hadolint --no-color
  fd -t f --glob 'Dockerfile*' -X hadolint --no-color
fi
"""

[tasks."lint:links"]
description = "Markdown ãƒªãƒ³ã‚¯ãƒã‚§ãƒƒã‚¯ï¼ˆæ™‚é–“ãŒã‹ã‹ã‚‹ãŸã‚å€‹åˆ¥å®Ÿè¡Œæ¨å¥¨ï¼‰"
run = "fd -e md -x markdown-link-check --config .markdown-link-check.json -q"

[tasks."lint:links:verbose"]
description = "Markdown ãƒªãƒ³ã‚¯ãƒã‚§ãƒƒã‚¯ï¼ˆè©³ç´°ãƒ¢ãƒ¼ãƒ‰ï¼‰"
run = "fd -e md -x markdown-link-check --config .markdown-link-check.json --verbose"

[tasks."lint:lua"]
description = "Lua ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒã‚§ãƒƒã‚¯"
depends = ["lint:lua:stylua", "lint:lua:luacheck"]

[tasks."lint:lua:stylua"]
description = "Stylua ã§ã‚³ãƒ¼ãƒ‰ã‚¹ã‚¿ã‚¤ãƒ«ã‚’ãƒã‚§ãƒƒã‚¯ï¼ˆLUA_FILES ã§å¯¾è±¡ã‚’é™å®šå¯èƒ½ï¼‰"
run = """
if [ -n "${LUA_FILES:-}" ]; then
  stylua --check ${LUA_FILES}
else
  stylua --check .
fi
"""

[tasks."lint:lua:luacheck"]
description = "luacheck ã‚’å®Ÿè¡Œï¼ˆåˆ©ç”¨å¯èƒ½ãªå ´åˆï¼‰"
run = "if command -v luacheck >/dev/null 2>&1; then luacheck -q .; fi"

# ========================================
# Test Tasks
# ========================================

[tasks."test:lua"]
description = "Lua ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œ(busted)"
run = """
# Add ~/.luarocks/bin to PATH if not already present
export PATH="${HOME}/.luarocks/bin:${PATH}"
busted --verbose spec/ nvim/spec/
"""

[tasks."test:lua:watch"]
description = "Lua ãƒ†ã‚¹ãƒˆã‚’ç›£è¦–ãƒ¢ãƒ¼ãƒ‰ã§å®Ÿè¡Œ(ãƒ•ã‚¡ã‚¤ãƒ«å¤‰æ›´æ™‚ã«è‡ªå‹•å†å®Ÿè¡Œ)"
run = """
export PATH="${HOME}/.luarocks/bin:${PATH}"
if command -v fswatch >/dev/null 2>&1; then
  echo "Watching spec/, nvim/spec/, and nvim/lua/ for changes..."
  fswatch -o spec/ nvim/spec/ nvim/lua/ wezterm/ | while read; do
    clear
    echo "=== Running tests at $(date) ==="
    busted --verbose spec/ nvim/spec/ || true
  done
else
  echo "âš ï¸  fswatch not installed. Install with: brew install fswatch"
  exit 1
fi
"""

# ========================================
# çµ±åˆã‚¿ã‚¹ã‚¯ï¼ˆã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ãƒ»è¨ºæ–­ãƒ»ä¸€æ‹¬å®Ÿè¡Œï¼‰
# ========================================

[tasks.setup]
description = "åˆå›ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—: ãƒ„ãƒ¼ãƒ«ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã€ä¾å­˜é–¢ä¿‚ã®ç¢ºèª"
run = """
echo "ğŸ“¦ Installing mise tools..."
mise install

echo ""
echo "ğŸ Installing Python packages for Neovim..."
PYTHON_PATH=$(mise where python)/bin/python3
$PYTHON_PATH -m pip install --quiet pynvim

echo ""
echo "ğŸ” Verifying critical tools..."
command -v biome >/dev/null || echo "âš ï¸  biome not found"
command -v prettier >/dev/null || echo "âš ï¸  prettier not found"
command -v stylua >/dev/null || echo "âš ï¸  stylua not found"
command -v shfmt >/dev/null || echo "âš ï¸  shfmt not found"
command -v shellcheck >/dev/null || echo "âš ï¸  shellcheck not found"
command -v taplo >/dev/null || echo "âš ï¸  taplo not found"
command -v yamllint >/dev/null || echo "âš ï¸  yamllint not found"
command -v markdownlint-cli2 >/dev/null || echo "âš ï¸  markdownlint-cli2 not found"
command -v uvx >/dev/null || echo "âš ï¸  uv not found"
$PYTHON_PATH -c "import pynvim; print('âœ“ pynvim:', pynvim.__version__)" || echo "âš ï¸  pynvim not found"

echo ""
echo "âœ… Setup complete. Run 'mise tasks' to see available tasks."
"""

[tasks.doctor]
description = "ç’°å¢ƒè¨ºæ–­: ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ¸ˆã¿ãƒ„ãƒ¼ãƒ«ã¨è¨­å®šã‚’ç¢ºèª"
run = """
echo "=== Mise Configuration ==="
mise doctor

echo ""
echo "=== Installed Tools ==="
mise ls

echo ""
echo "=== Available Tasks ==="
mise tasks | head -20
echo "... (run 'mise tasks' to see all)"
"""

[tasks.format]
description = "å…¨ãƒ•ã‚¡ã‚¤ãƒ«ã‚¿ã‚¤ãƒ—ã®ä¸€æ‹¬ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆï¼ˆè‡ªå‹•ä¿®æ­£ï¼‰"
depends = [
  "format:biome",
  "format:prettier",
  "format:markdown",
  "format:yaml",
  "format:lua",
  "format:shell",
  "format:toml",
  "format:python",
]

[tasks.lint]
description = "å…¨ãƒ•ã‚¡ã‚¤ãƒ«ã‚¿ã‚¤ãƒ—ã®ä¸€æ‹¬Lintï¼ˆãƒã‚§ãƒƒã‚¯ã®ã¿ï¼‰"
depends = [
  "lint:biome",
  "lint:markdown",
  "lint:yaml",
  "lint:lua",
  "lint:shell",
  "lint:toml",
  "lint:python",
]

[tasks.check]
description = "format + lint ã®å®Œå…¨ãƒã‚§ãƒƒã‚¯ï¼ˆæ›¸ãè¾¼ã¿ãªã—ã€CI/pre-commitç”¨ï¼‰"
depends = [
  "format:biome:check",
  "format:prettier:check",
  "format:markdown:check",
  "format:yaml:check",
  "format:lua:check",
  "format:shell:check",
  "format:toml:check",
  "format:python:check",
  "lint",
]
